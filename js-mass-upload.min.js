!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.MassUpload=t()}}(function(){var t;return function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){var n,r,i,o,s,u,a,l,c,h=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;n=t("backbone"),c=t("underscore"),a=t("./MassUpload/UploadCollection"),i=t("./MassUpload/FileLister"),o=t("./MassUpload/FileUploader"),r=t("./MassUpload/FileDeleter"),u=t("./MassUpload/State"),l=t("./MassUpload/UploadProgress"),e.exports=s=function(t){function e(t){this._removedUploads=[],e.__super__.constructor.call(this,{},t)}return h(e,t),e.prototype.defaults=function(){return{status:"waiting",listFilesProgress:null,listFilesError:null,uploadProgress:null,uploadErrors:[]}},e.prototype.initialize=function(t,e){var n,r;return this._options=e,this.uploads=null!=(r=null!=e?e.uploads:void 0)?r:new a,this._uploadProgress=new l({uploadCollection:this.uploads}),n=function(t){return function(){return t.set({uploadProgress:t._uploadProgress.pick("loaded","total")})}}(this),this.listenTo(this._uploadProgress,"change",n),n(),this.listenTo(this.uploads,"add-batch",this._onUploadBatchAdded),this.listenTo(this.uploads,"change",function(t){return function(e){return t._onUploadChanged(e)}}(this)),this.listenTo(this.uploads,"reset",function(t){return function(){return t._onUploadsReset()}}(this)),this.prepare()},e.prototype.prepare=function(){var t,e,n,s;return t=this._options,this.lister=null!=(e=null!=t?t.lister:void 0)?e:new i(t.doListFiles),this.lister.callbacks={onStart:function(t){return function(){return t._onListerStart()}}(this),onProgress:function(t){return function(e){return t._onListerProgress(e)}}(this),onSuccess:function(t){return function(e){return t._onListerSuccess(e)}}(this),onError:function(t){return function(e){return t._onListerError(e)}}(this),onStop:function(t){return function(){return t._onListerStop()}}(this)},this.uploader=null!=(n=null!=t?t.uploader:void 0)?n:new o(t.doUploadFile),this.uploader.callbacks={onStart:function(t){return function(e){return t._onUploaderStart(e)}}(this),onStop:function(t){return function(e){return t._onUploaderStop(e)}}(this),onSuccess:function(t){return function(e){return t._onUploaderSuccess(e)}}(this),onError:function(t){return function(e,n){return t._onUploaderError(e,n)}}(this),onProgress:function(t){return function(e,n){return t._onUploaderProgress(e,n)}}(this)},this.deleter=null!=(s=null!=t?t.deleter:void 0)?s:new r(t.doDeleteFile),this.deleter.callbacks={onStart:function(t){return function(e){return t._onDeleterStart(e)}}(this),onSuccess:function(t){return function(e){return t._onDeleterSuccess(e)}}(this),onError:function(t){return function(e,n){return t._onDeleterError(e,n)}}(this),onStop:function(t){return function(e){return t._onDeleterStop(e)}}(this)}},e.prototype.fetchFileInfosFromServer=function(){return this.lister.run()},e.prototype.retryListFiles=function(){return this.fetchFileInfosFromServer()},e.prototype.retryUpload=function(t){return t.set({error:null})},e.prototype.retryAllUploads=function(){return this.uploads.each(function(t){return t.set({error:null})})},e.prototype.addFiles=function(t){return this._uploadProgress.inBatch(function(e){return function(){return e.uploads.addFiles(t)}}(this))},e.prototype.removeUpload=function(t){return t.set({deleting:!0})},e.prototype.abort=function(){return this.uploads.each(function(t){return function(e){return t.removeUpload(e)}}(this)),this.uploads.reset(),this.prepare()},e.prototype._onListerStart=function(){return this.set({status:"listing-files",listFilesError:null})},e.prototype._onListerProgress=function(t){return this.set({listFilesProgress:t})},e.prototype._onListerSuccess=function(t){return this.uploads.addFileInfos(t),this._tick()},e.prototype._onListerError=function(t){return this.set({listFilesError:t,status:"listing-files-error"})},e.prototype._onListerStop=function(){},e.prototype._mergeUploadError=function(t,e,n){var r,i;return i=this.get("uploadErrors").slice(0),r=c.sortedIndex(i,{upload:t},function(t){return t.upload.id}),null==e?i.splice(r,0,{upload:t,error:n}):null==n?i.splice(r,1):i[r].error=n,this.set({uploadErrors:i})},e.prototype._onUploadBatchAdded=function(t){var e,n,r,i;for(r=0,i=t.length;i>r;r++)n=t[r],e=n.get("error"),null!=e&&this._mergeUploadError(n,null,e);return this._forceBestTick()},e.prototype._onUploadChanged=function(t){var e,n,r,i;return r=t.previousAttributes().error,i=t.get("error"),r!==i&&this._mergeUploadError(t,r,i),e=t.previousAttributes().deleting,n=t.get("deleting"),n&&!e&&this._removedUploads.push(t),this._forceBestTick()},e.prototype._onUploadsReset=function(){var t;return t=[],this.uploads.each(function(e){var n;return(n=e.get("error"))?t.push({upload:e,error:n}):void 0}),this.set({uploadErrors:t}),this._tick()},e.prototype._onUploaderStart=function(t){var e;return e=this.uploads.forFile(t),e.set({uploading:!0,error:null})},e.prototype._onUploaderStop=function(t){var e;return e=this.uploads.forFile(t),e.set({uploading:!1}),this._tick()},e.prototype._onUploaderProgress=function(t,e){var n;return n=this.uploads.forFile(t),n.updateWithProgress(e)},e.prototype._onUploaderError=function(t,e){var n;return n=this.uploads.forFile(t),n.set({error:e})},e.prototype._onUploaderSuccess=function(t){var e;return e=this.uploads.forFile(t),e.updateWithProgress({loaded:e.size(),total:e.size()})},e.prototype._onDeleterStart=function(){return this.set({status:"uploading"})},e.prototype._onDeleterSuccess=function(t){var e;return e=this.uploads.forFileInfo(t),this.uploads.remove(e)},e.prototype._onDeleterError=function(t,e){var n;return n=this.uploads.forFileInfo(t),n.set({error:e})},e.prototype._onDeleterStop=function(){return this._tick()},e.prototype._tick=function(){var t,e,n;return n=this.uploads.next(),this._currentUpload=n,null!=n&&(n.get("deleting")?this.deleter.run(n.get("fileInfo")):this.uploader.run(n.get("file"))),e=this.get("uploadErrors").length?"uploading-error":null!=n?"uploading":(t=this.get("uploadProgress"),t.loaded===t.total?"waiting":"waiting-error"),this.set({status:e})},e.prototype._forceBestTick=function(){var t;return t=this.uploads.next(),t!==this._currentUpload?this._currentUpload?this.uploader.abort():this._tick():void 0},e}(n.Model)},{"./MassUpload/FileDeleter":4,"./MassUpload/FileLister":6,"./MassUpload/FileUploader":7,"./MassUpload/State":8,"./MassUpload/UploadCollection":10,"./MassUpload/UploadProgress":11,backbone:2,underscore:3}],2:[function(e,n,r){!function(n,i){if("function"==typeof t&&t.amd)t(["underscore","jquery","exports"],function(t,e,r){n.Backbone=i(n,r,t,e)});else if("undefined"!=typeof r){var o=e("underscore");i(n,r,o)}else n.Backbone=i(n,{},n._,n.jQuery||n.Zepto||n.ender||n.$)}(this,function(t,e,n,r){{var i=t.Backbone,o=[],s=(o.push,o.slice);o.splice}e.VERSION="1.1.2",e.$=r,e.noConflict=function(){return t.Backbone=i,this},e.emulateHTTP=!1,e.emulateJSON=!1;var u=e.Events={on:function(t,e,n){if(!l(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,r){if(!l(this,"once",t,[e,r])||!e)return this;var i=this,o=n.once(function(){i.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,r)},off:function(t,e,r){var i,o,s,u,a,c,h,f;if(!this._events||!l(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._events=void 0,this;for(u=t?[t]:n.keys(this._events),a=0,c=u.length;c>a;a++)if(t=u[a],s=this._events[t]){if(this._events[t]=i=[],e||r)for(h=0,f=s.length;f>h;h++)o=s[h],(e&&e!==o.callback&&e!==o.callback._callback||r&&r!==o.context)&&i.push(o);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&c(n,e),r&&c(r,arguments),this},stopListening:function(t,e,r){var i=this._listeningTo;if(!i)return this;var o=!e&&!r;r||"object"!=typeof e||(r=this),t&&((i={})[t._listenId]=t);for(var s in i)t=i[s],t.off(e,r,this),(o||n.isEmpty(t._events))&&delete this._listeningTo[s];return this}},a=/\s+/,l=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(a.test(n)){for(var o=n.split(a),s=0,u=o.length;u>s;s++)t[e].apply(t,[o[s]].concat(r));return!1}return!0},c=function(t,e){var n,r=-1,i=t.length,o=e[0],s=e[1],u=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,s);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,s,u);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e);return}},h={listenTo:"on",listenToOnce:"once"};n.each(h,function(t,e){u[e]=function(e,r,i){var o=this._listeningTo||(this._listeningTo={}),s=e._listenId||(e._listenId=n.uniqueId("l"));return o[s]=e,i||"object"!=typeof r||(i=this),e[t](r,i,this),this}}),u.bind=u.on,u.unbind=u.off,n.extend(e,u);var f=e.Model=function(t,e){var r=t||{};e||(e={}),this.cid=n.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(r=this.parse(r,e)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(f.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,r){var i,o,s,u,a,l,c,h;if(null==t)return this;if("object"==typeof t?(o=t,r=e):(o={})[t]=e,r||(r={}),!this._validate(o,r))return!1;s=r.unset,a=r.silent,u=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=n.clone(this.attributes),this.changed={}),h=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(i in o)e=o[i],n.isEqual(h[i],e)||u.push(i),n.isEqual(c[i],e)?delete this.changed[i]:this.changed[i]=e,s?delete h[i]:h[i]=e;if(!a){u.length&&(this._pending=r);for(var f=0,p=u.length;p>f;f++)this.trigger("change:"+u[f],this,h[u[f]],r)}if(l)return this;if(!a)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?n.clone(this.changed):!1;var e,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var o in t)n.isEqual(i[o],e=t[o])||((r||(r={}))[o]=e);return r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,r=t.success;return t.success=function(n){return e.set(e.parse(n,t),t)?(r&&r(e,n,t),void e.trigger("sync",e,n,t)):!1},L(this,t),this.sync("read",this,t)},save:function(t,e,r){var i,o,s,u=this.attributes;if(null==t||"object"==typeof t?(i=t,r=e):(i={})[t]=e,r=n.extend({validate:!0},r),i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),void 0===r.parse&&(r.parse=!0);var a=this,l=r.success;return r.success=function(t){a.attributes=u;var e=a.parse(t,r);return r.wait&&(e=n.extend(i||{},e)),n.isObject(e)&&!a.set(e,r)?!1:(l&&l(a,t,r),void a.trigger("sync",a,t,r))},L(this,r),o=this.isNew()?"create":r.patch?"patch":"update","patch"===o&&(r.attrs=i),s=this.sync(o,this,r),i&&r.wait&&(this.attributes=u),s},destroy:function(t){t=t?n.clone(t):{};var e=this,r=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(n){(t.wait||e.isNew())&&i(),r&&r(e,n,t),e.isNew()||e.trigger("sync",e,n,t)},this.isNew())return t.success(),!1;L(this,t);var o=this.sync("delete",this,t);return t.wait||i(),o},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||R();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var r=this.validationError=this.validate(t,e)||null;return r?(this.trigger("invalid",this,r,n.extend(e,{validationError:r})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];n.each(p,function(t){f.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.attributes),n[t].apply(n,e)}});var d=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1};n.extend(d.prototype,u,{model:f,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,v))},remove:function(t,e){var r=!n.isArray(t);t=r?[t]:n.clone(t),e||(e={});var i,o,s,u;for(i=0,o=t.length;o>i;i++)u=t[i]=this.get(t[i]),u&&(delete this._byId[u.id],delete this._byId[u.cid],s=this.indexOf(u),this.models.splice(s,1),this.length--,e.silent||(e.index=s,u.trigger("remove",u,this,e)),this._removeReference(u,e));return r?t[0]:t},set:function(t,e){e=n.defaults({},e,g),e.parse&&(t=this.parse(t,e));var r=!n.isArray(t);t=r?t?[t]:[]:n.clone(t);var i,o,s,u,a,l,c,h=e.at,p=this.model,d=this.comparator&&null==h&&e.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,y=[],m=[],_={},b=e.add,w=e.merge,x=e.remove,S=!d&&b&&x?[]:!1;for(i=0,o=t.length;o>i;i++){if(a=t[i]||{},s=a instanceof f?u=a:a[p.prototype.idAttribute||"id"],l=this.get(s))x&&(_[l.cid]=!0),w&&(a=a===u?u.attributes:a,e.parse&&(a=l.parse(a,e)),l.set(a,e),d&&!c&&l.hasChanged(v)&&(c=!0)),t[i]=l;else if(b){if(u=t[i]=this._prepareModel(a,e),!u)continue;y.push(u),this._addReference(u,e)}u=l||u,!S||!u.isNew()&&_[u.id]||S.push(u),_[u.id]=!0}if(x){for(i=0,o=this.length;o>i;++i)_[(u=this.models[i]).cid]||m.push(u);m.length&&this.remove(m,e)}if(y.length||S&&S.length)if(d&&(c=!0),this.length+=y.length,null!=h)for(i=0,o=y.length;o>i;i++)this.models.splice(h+i,0,y[i]);else{S&&(this.models.length=0);var k=S||y;for(i=0,o=k.length;o>i;i++)this.models.push(k[i])}if(c&&this.sort({silent:!0}),!e.silent){for(i=0,o=y.length;o>i;i++)(u=y[i]).trigger("add",u,this,e);(c||S&&S.length)&&this.trigger("sort",this,e)}return r?t[0]:t},reset:function(t,e){e||(e={});for(var r=0,i=this.models.length;i>r;r++)this._removeReference(this.models[r],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return n.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return n.invoke(this.models,"get",t)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,r=this;return t.success=function(n){var i=t.reset?"reset":"set";r[i](n,t),e&&e(r,n,t),r.trigger("sync",r,n,t)},L(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?n.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var r=this,i=e.success;return e.success=function(t,n){e.wait&&r.add(t,e),i&&i(t,n,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof f)return t;e=e?n.clone(e):{},e.collection=this;var r=new this.model(t,e);return r.validationError?(this.trigger("invalid",this,r.validationError,e),!1):r},_addReference:function(t){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(y,function(t){d.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),n[t].apply(n,e)}});var m=["groupBy","countBy","sortBy","indexBy"];n.each(m,function(t){d.prototype[t]=function(e,r){var i=n.isFunction(e)?e:function(t){return t.get(e)};return n[t](this.models,i,r)}});var _=e.View=function(t){this.cid=n.uniqueId("view"),t||(t={}),n.extend(this,n.pick(t,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];n.extend(_.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=n.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var r=t[e];if(n.isFunction(r)||(r=this[t[e]]),r){var i=e.match(b),o=i[1],s=i[2];r=n.bind(r,this),o+=".delegateEvents"+this.cid,""===s?this.$el.on(o,r):this.$el.on(o,s,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t["class"]=n.result(this,"className"));var r=e.$("<"+n.result(this,"tagName")+">").attr(t);this.setElement(r,!1)}}}),e.sync=function(t,r,i){var o=S[t];n.defaults(i||(i={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:o,dataType:"json"};if(i.url||(s.url=n.result(r,"url")||R()),null!=i.data||!r||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),i.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",i.emulateJSON&&(s.data._method=o);var u=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",o),u?u.apply(this,arguments):void 0}}"GET"===s.type||i.emulateJSON||(s.processData=!1),"PATCH"===s.type&&x&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=e.ajax(n.extend(s,i));return r.trigger("request",r,a,i),a};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var k=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,U=/(\(\?)?:\w+/g,A=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(k.prototype,u,{initialize:function(){},route:function(t,r,i){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var o=this;return e.history.route(t,function(n){var s=o._extractParameters(t,n);o.execute(i,s),o.trigger.apply(o,["route:"+r].concat(s)),o.trigger("route",r,s),e.history.trigger("route",o,r,s)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(F,"\\$&").replace(E,"(?:$1)?").replace(U,function(t,e){return e?t:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return n.map(r,function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null})}});var T=e.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},P=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,j=/msie [\w.]+/,M=/\/$/,O=/#.*$/;T.started=!1,n.extend(T.prototype,u,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(M,"");t.indexOf(n)||(t=t.slice(n.length))}else t=this.getHash();return t.replace(P,"")},start:function(t){if(T.started)throw new Error("Backbone.history has already been started");T.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,o=j.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);if(this.root=("/"+this.root+"/").replace(I,"/"),o&&this._wantsHashChange){var s=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(P,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),T.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),n.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!T.started)return!1;e&&e!==!0||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=t.replace(O,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),e.history=new T;var C=function(t,e){var r,i=this;r=t&&n.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},n.extend(r,i,e);var o=function(){this.constructor=r};return o.prototype=i.prototype,r.prototype=new o,t&&n.extend(r.prototype,t),r.__super__=i.prototype,r};f.extend=d.extend=k.extend=_.extend=T.extend=C;var R=function(){throw new Error('A "url" property or function must be specified')},L=function(t,e){var n=e.error;e.error=function(r){n&&n(t,r,e),t.trigger("error",t,r,e)}};return e})},{underscore:3}],3:[function(e,n,r){(function(){var e=this,i=e._,o=Array.prototype,s=Object.prototype,u=Function.prototype,a=o.push,l=o.slice,c=o.concat,h=s.toString,f=s.hasOwnProperty,p=Array.isArray,d=Object.keys,g=u.bind,v=function(t){return t instanceof v?t:this instanceof v?void(this._wrapped=t):new v(t)};"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=v),r._=v):e._=v,v.VERSION="1.7.0";var y=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}};v.iteratee=function(t,e,n){return null==t?v.identity:v.isFunction(t)?y(t,e,n):v.isObject(t)?v.matches(t):v.property(t)},v.each=v.forEach=function(t,e,n){if(null==t)return t;e=y(e,n);var r,i=t.length;if(i===+i)for(r=0;i>r;r++)e(t[r],r,t);else{var o=v.keys(t);for(r=0,i=o.length;i>r;r++)e(t[o[r]],o[r],t)}return t},v.map=v.collect=function(t,e,n){if(null==t)return[];e=v.iteratee(e,n);for(var r,i=t.length!==+t.length&&v.keys(t),o=(i||t).length,s=Array(o),u=0;o>u;u++)r=i?i[u]:u,s[u]=e(t[r],r,t);return s};var m="Reduce of empty array with no initial value";v.reduce=v.foldl=v.inject=function(t,e,n,r){null==t&&(t=[]),e=y(e,r,4);var i,o=t.length!==+t.length&&v.keys(t),s=(o||t).length,u=0;if(arguments.length<3){if(!s)throw new TypeError(m);n=t[o?o[u++]:u++]}for(;s>u;u++)i=o?o[u]:u,n=e(n,t[i],i,t);return n},v.reduceRight=v.foldr=function(t,e,n,r){null==t&&(t=[]),e=y(e,r,4);var i,o=t.length!==+t.length&&v.keys(t),s=(o||t).length;if(arguments.length<3){if(!s)throw new TypeError(m);n=t[o?o[--s]:--s]}for(;s--;)i=o?o[s]:s,n=e(n,t[i],i,t);return n},v.find=v.detect=function(t,e,n){var r;return e=v.iteratee(e,n),v.some(t,function(t,n,i){return e(t,n,i)?(r=t,!0):void 0}),r},v.filter=v.select=function(t,e,n){var r=[];return null==t?r:(e=v.iteratee(e,n),v.each(t,function(t,n,i){e(t,n,i)&&r.push(t)}),r)},v.reject=function(t,e,n){return v.filter(t,v.negate(v.iteratee(e)),n)},v.every=v.all=function(t,e,n){if(null==t)return!0;e=v.iteratee(e,n);var r,i,o=t.length!==+t.length&&v.keys(t),s=(o||t).length;for(r=0;s>r;r++)if(i=o?o[r]:r,!e(t[i],i,t))return!1;return!0},v.some=v.any=function(t,e,n){if(null==t)return!1;e=v.iteratee(e,n);var r,i,o=t.length!==+t.length&&v.keys(t),s=(o||t).length;for(r=0;s>r;r++)if(i=o?o[r]:r,e(t[i],i,t))return!0;return!1},v.contains=v.include=function(t,e){return null==t?!1:(t.length!==+t.length&&(t=v.values(t)),v.indexOf(t,e)>=0)},v.invoke=function(t,e){var n=l.call(arguments,2),r=v.isFunction(e);return v.map(t,function(t){return(r?e:t[e]).apply(t,n)})},v.pluck=function(t,e){return v.map(t,v.property(e))},v.where=function(t,e){return v.filter(t,v.matches(e))},v.findWhere=function(t,e){return v.find(t,v.matches(e))},v.max=function(t,e,n){var r,i,o=-1/0,s=-1/0;if(null==e&&null!=t){t=t.length===+t.length?t:v.values(t);for(var u=0,a=t.length;a>u;u++)r=t[u],r>o&&(o=r)}else e=v.iteratee(e,n),v.each(t,function(t,n,r){i=e(t,n,r),(i>s||i===-1/0&&o===-1/0)&&(o=t,s=i)});return o},v.min=function(t,e,n){var r,i,o=1/0,s=1/0;if(null==e&&null!=t){t=t.length===+t.length?t:v.values(t);for(var u=0,a=t.length;a>u;u++)r=t[u],o>r&&(o=r)}else e=v.iteratee(e,n),v.each(t,function(t,n,r){i=e(t,n,r),(s>i||1/0===i&&1/0===o)&&(o=t,s=i)});return o},v.shuffle=function(t){for(var e,n=t&&t.length===+t.length?t:v.values(t),r=n.length,i=Array(r),o=0;r>o;o++)e=v.random(0,o),e!==o&&(i[o]=i[e]),i[e]=n[o];return i},v.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=v.values(t)),t[v.random(t.length-1)]):v.shuffle(t).slice(0,Math.max(0,e))},v.sortBy=function(t,e,n){return e=v.iteratee(e,n),v.pluck(v.map(t,function(t,n,r){return{value:t,index:n,criteria:e(t,n,r)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return t.index-e.index}),"value")};var _=function(t){return function(e,n,r){var i={};return n=v.iteratee(n,r),v.each(e,function(r,o){var s=n(r,o,e);t(i,r,s)}),i}};v.groupBy=_(function(t,e,n){v.has(t,n)?t[n].push(e):t[n]=[e]}),v.indexBy=_(function(t,e,n){t[n]=e}),v.countBy=_(function(t,e,n){v.has(t,n)?t[n]++:t[n]=1}),v.sortedIndex=function(t,e,n,r){n=v.iteratee(n,r,1);for(var i=n(e),o=0,s=t.length;s>o;){var u=o+s>>>1;n(t[u])<i?o=u+1:s=u}return o},v.toArray=function(t){return t?v.isArray(t)?l.call(t):t.length===+t.length?v.map(t,v.identity):v.values(t):[]},v.size=function(t){return null==t?0:t.length===+t.length?t.length:v.keys(t).length},v.partition=function(t,e,n){e=v.iteratee(e,n);var r=[],i=[];return v.each(t,function(t,n,o){(e(t,n,o)?r:i).push(t)}),[r,i]},v.first=v.head=v.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:0>e?[]:l.call(t,0,e)},v.initial=function(t,e,n){return l.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},v.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:l.call(t,Math.max(t.length-e,0))},v.rest=v.tail=v.drop=function(t,e,n){return l.call(t,null==e||n?1:e)},v.compact=function(t){return v.filter(t,v.identity)};var b=function(t,e,n,r){if(e&&v.every(t,v.isArray))return c.apply(r,t);for(var i=0,o=t.length;o>i;i++){var s=t[i];v.isArray(s)||v.isArguments(s)?e?a.apply(r,s):b(s,e,n,r):n||r.push(s)}return r};v.flatten=function(t,e){return b(t,e,!1,[])},v.without=function(t){return v.difference(t,l.call(arguments,1))},v.uniq=v.unique=function(t,e,n,r){if(null==t)return[];v.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=v.iteratee(n,r));for(var i=[],o=[],s=0,u=t.length;u>s;s++){var a=t[s];
if(e)s&&o===a||i.push(a),o=a;else if(n){var l=n(a,s,t);v.indexOf(o,l)<0&&(o.push(l),i.push(a))}else v.indexOf(i,a)<0&&i.push(a)}return i},v.union=function(){return v.uniq(b(arguments,!0,!0,[]))},v.intersection=function(t){if(null==t)return[];for(var e=[],n=arguments.length,r=0,i=t.length;i>r;r++){var o=t[r];if(!v.contains(e,o)){for(var s=1;n>s&&v.contains(arguments[s],o);s++);s===n&&e.push(o)}}return e},v.difference=function(t){var e=b(l.call(arguments,1),!0,!0,[]);return v.filter(t,function(t){return!v.contains(e,t)})},v.zip=function(t){if(null==t)return[];for(var e=v.max(arguments,"length").length,n=Array(e),r=0;e>r;r++)n[r]=v.pluck(arguments,r);return n},v.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;i>r;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},v.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return r=v.sortedIndex(t,e),t[r]===e?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(t[r]===e)return r;return-1},v.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=t.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(t[r]===e)return r;return-1},v.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=n||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;r>o;o++,t+=n)i[o]=t;return i};var w=function(){};v.bind=function(t,e){var n,r;if(g&&t.bind===g)return g.apply(t,l.call(arguments,1));if(!v.isFunction(t))throw new TypeError("Bind must be called on a function");return n=l.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(e,n.concat(l.call(arguments)));w.prototype=t.prototype;var i=new w;w.prototype=null;var o=t.apply(i,n.concat(l.call(arguments)));return v.isObject(o)?o:i}},v.partial=function(t){var e=l.call(arguments,1);return function(){for(var n=0,r=e.slice(),i=0,o=r.length;o>i;i++)r[i]===v&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return t.apply(this,r)}},v.bindAll=function(t){var e,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(e=1;r>e;e++)n=arguments[e],t[n]=v.bind(t[n],t);return t},v.memoize=function(t,e){var n=function(r){var i=n.cache,o=e?e.apply(this,arguments):r;return v.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},v.delay=function(t,e){var n=l.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},v.defer=function(t){return v.delay.apply(v,[t,1].concat(l.call(arguments,1)))},v.throttle=function(t,e,n){var r,i,o,s=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:v.now(),s=null,o=t.apply(r,i),s||(r=i=null)};return function(){var l=v.now();u||n.leading!==!1||(u=l);var c=e-(l-u);return r=this,i=arguments,0>=c||c>e?(clearTimeout(s),s=null,u=l,o=t.apply(r,i),s||(r=i=null)):s||n.trailing===!1||(s=setTimeout(a,c)),o}},v.debounce=function(t,e,n){var r,i,o,s,u,a=function(){var l=v.now()-s;e>l&&l>0?r=setTimeout(a,e-l):(r=null,n||(u=t.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,s=v.now();var l=n&&!r;return r||(r=setTimeout(a,e)),l&&(u=t.apply(o,i),o=i=null),u}},v.wrap=function(t,e){return v.partial(e,t)},v.negate=function(t){return function(){return!t.apply(this,arguments)}},v.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},v.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},v.before=function(t,e){var n;return function(){return--t>0?n=e.apply(this,arguments):e=null,n}},v.once=v.partial(v.before,2),v.keys=function(t){if(!v.isObject(t))return[];if(d)return d(t);var e=[];for(var n in t)v.has(t,n)&&e.push(n);return e},v.values=function(t){for(var e=v.keys(t),n=e.length,r=Array(n),i=0;n>i;i++)r[i]=t[e[i]];return r},v.pairs=function(t){for(var e=v.keys(t),n=e.length,r=Array(n),i=0;n>i;i++)r[i]=[e[i],t[e[i]]];return r},v.invert=function(t){for(var e={},n=v.keys(t),r=0,i=n.length;i>r;r++)e[t[n[r]]]=n[r];return e},v.functions=v.methods=function(t){var e=[];for(var n in t)v.isFunction(t[n])&&e.push(n);return e.sort()},v.extend=function(t){if(!v.isObject(t))return t;for(var e,n,r=1,i=arguments.length;i>r;r++){e=arguments[r];for(n in e)f.call(e,n)&&(t[n]=e[n])}return t},v.pick=function(t,e,n){var r,i={};if(null==t)return i;if(v.isFunction(e)){e=y(e,n);for(r in t){var o=t[r];e(o,r,t)&&(i[r]=o)}}else{var s=c.apply([],l.call(arguments,1));t=new Object(t);for(var u=0,a=s.length;a>u;u++)r=s[u],r in t&&(i[r]=t[r])}return i},v.omit=function(t,e,n){if(v.isFunction(e))e=v.negate(e);else{var r=v.map(c.apply([],l.call(arguments,1)),String);e=function(t,e){return!v.contains(r,e)}}return v.pick(t,e,n)},v.defaults=function(t){if(!v.isObject(t))return t;for(var e=1,n=arguments.length;n>e;e++){var r=arguments[e];for(var i in r)void 0===t[i]&&(t[i]=r[i])}return t},v.clone=function(t){return v.isObject(t)?v.isArray(t)?t.slice():v.extend({},t):t},v.tap=function(t,e){return e(t),t};var x=function(t,e,n,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof v&&(t=t._wrapped),e instanceof v&&(e=e._wrapped);var i=h.call(t);if(i!==h.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]===t)return r[o]===e;var s=t.constructor,u=e.constructor;if(s!==u&&"constructor"in t&&"constructor"in e&&!(v.isFunction(s)&&s instanceof s&&v.isFunction(u)&&u instanceof u))return!1;n.push(t),r.push(e);var a,l;if("[object Array]"===i){if(a=t.length,l=a===e.length)for(;a--&&(l=x(t[a],e[a],n,r)););}else{var c,f=v.keys(t);if(a=f.length,l=v.keys(e).length===a)for(;a--&&(c=f[a],l=v.has(e,c)&&x(t[c],e[c],n,r)););}return n.pop(),r.pop(),l};v.isEqual=function(t,e){return x(t,e,[],[])},v.isEmpty=function(t){if(null==t)return!0;if(v.isArray(t)||v.isString(t)||v.isArguments(t))return 0===t.length;for(var e in t)if(v.has(t,e))return!1;return!0},v.isElement=function(t){return!(!t||1!==t.nodeType)},v.isArray=p||function(t){return"[object Array]"===h.call(t)},v.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},v.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){v["is"+t]=function(e){return h.call(e)==="[object "+t+"]"}}),v.isArguments(arguments)||(v.isArguments=function(t){return v.has(t,"callee")}),"function"!=typeof/./&&(v.isFunction=function(t){return"function"==typeof t||!1}),v.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},v.isNaN=function(t){return v.isNumber(t)&&t!==+t},v.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===h.call(t)},v.isNull=function(t){return null===t},v.isUndefined=function(t){return void 0===t},v.has=function(t,e){return null!=t&&f.call(t,e)},v.noConflict=function(){return e._=i,this},v.identity=function(t){return t},v.constant=function(t){return function(){return t}},v.noop=function(){},v.property=function(t){return function(e){return e[t]}},v.matches=function(t){var e=v.pairs(t),n=e.length;return function(t){if(null==t)return!n;t=new Object(t);for(var r=0;n>r;r++){var i=e[r],o=i[0];if(i[1]!==t[o]||!(o in t))return!1}return!0}},v.times=function(t,e,n){var r=Array(Math.max(0,t));e=y(e,n,1);for(var i=0;t>i;i++)r[i]=e(i);return r},v.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},v.now=Date.now||function(){return(new Date).getTime()};var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},k=v.invert(S),E=function(t){var e=function(e){return t[e]},n="(?:"+v.keys(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}};v.escape=E(S),v.unescape=E(k),v.result=function(t,e){if(null==t)return void 0;var n=t[e];return v.isFunction(n)?t[e]():n};var U=0;v.uniqueId=function(t){var e=++U+"";return t?t+e:e},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},T=/\\|'|\r|\n|\u2028|\u2029/g,P=function(t){return"\\"+F[t]};v.template=function(t,e,n){!e&&n&&(e=n),e=v.defaults({},e,v.templateSettings);var r=RegExp([(e.escape||A).source,(e.interpolate||A).source,(e.evaluate||A).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,function(e,n,r,s,u){return o+=t.slice(i,u).replace(T,P),i=u+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(u){throw u.source=o,u}var a=function(t){return s.call(this,t,v)},l=e.variable||"obj";return a.source="function("+l+"){\n"+o+"}",a},v.chain=function(t){var e=v(t);return e._chain=!0,e};var I=function(t){return this._chain?v(t).chain():t};v.mixin=function(t){v.each(v.functions(t),function(e){var n=v[e]=t[e];v.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),I.call(this,n.apply(v,t))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=o[t];v.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],I.call(this,n)}}),v.each(["concat","join","slice"],function(t){var e=o[t];v.prototype[t]=function(){return I.call(this,e.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},"function"==typeof t&&t.amd&&t("underscore",[],function(){return v})}).call(this)},{}],4:[function(t,e){var n;e.exports=n=function(){function t(t,e){this.doDeleteFile=t,this.callbacks=null!=e?e:{},this.running=!1}return t.prototype.run=function(t){var e;if(this.running)throw"already running";return this.running=!0,"function"==typeof(e=this.callbacks).onStart&&e.onStart(t),this.doDeleteFile(t,function(e){return function(){return e._onSuccess(t)}}(this),function(e){return function(n){return e._onError(t,n)}}(this))},t.prototype._onSuccess=function(t){var e;return"function"==typeof(e=this.callbacks).onSuccess&&e.onSuccess(t),this._onStop(t)},t.prototype._onError=function(t,e){var n;return"function"==typeof(n=this.callbacks).onError&&n.onError(t,e),this._onStop(t)},t.prototype._onStop=function(t){var e;return this.running=!1,void("function"==typeof(e=this.callbacks).onStop&&e.onStop(t))},t}()},{}],5:[function(t,e){var n;e.exports=n=function(){function t(t,e,n,r){this.name=t,this.lastModifiedDate=e,this.total=n,this.loaded=r}return t}(),n.fromJson=function(t){return new n(t.name,new Date(t.lastModifiedDate),t.total,t.loaded)},n.fromFile=function(t){return new n(t.webkitRelativePath||t.name,t.lastModifiedDate,t.size,0)}},{}],6:[function(t,e){var n;e.exports=n=function(){function t(t,e){this.doListFiles=t,this.callbacks=e,this.running=!1}return t.prototype.run=function(){var t;if(this.running)throw"already running";return this.running=!0,"function"==typeof(t=this.callbacks).onStart&&t.onStart(),this.doListFiles(function(t){return function(e){var n;return"function"==typeof(n=t.callbacks).onProgress?n.onProgress(e):void 0}}(this),function(t){return function(e){return t._onSuccess(e)}}(this),function(t){return function(e){return t._onError(e)}}(this))},t.prototype._onSuccess=function(t){var e;return"function"==typeof(e=this.callbacks).onSuccess&&e.onSuccess(t),this._onStop()},t.prototype._onError=function(t){return this.callbacks.onError(t),this._onStop()},t.prototype._onStop=function(){var t;return this.running=!1,"function"==typeof(t=this.callbacks).onStop?t.onStop():void 0},t}()},{}],7:[function(t,e){var n,r;n=t("./FileInfo"),e.exports=r=function(){function t(t,e){this.doUpload=t,this.callbacks=e,this._file=null,this._abortCallback=null,this._aborting=!1}return t.prototype.run=function(t){var e;if(null!=this._file)throw"already running";return this._file=t,"function"==typeof(e=this.callbacks).onStart&&e.onStart(this._file),this._abortCallback=this.doUpload(t,function(e){return function(n){return e._onProgress(t,n)}}(this),function(e){return function(){return e._onSuccess(t)}}(this),function(e){return function(n){return e._onError(t,n)}}(this))},t.prototype.abort=function(){return this._file&&!this._aborting&&(this._aborting=!0,"function"==typeof this._abortCallback)?this._abortCallback():void 0},t.prototype._onProgress=function(t,e){var n;return"function"==typeof(n=this.callbacks).onProgress?n.onProgress(t,e):void 0},t.prototype._onSuccess=function(t){var e;return"function"==typeof(e=this.callbacks).onSuccess&&e.onSuccess(t),this._onStop(t)},t.prototype._onError=function(t,e){var n;return"function"==typeof(n=this.callbacks).onError&&n.onError(t,e),this._onStop(t)},t.prototype._onStop=function(t){var e;return this._file=null,this._abortCallback=null,this._aborting=!1,"function"==typeof(e=this.callbacks).onStop?e.onStop(t):void 0},t}()},{"./FileInfo":5}],8:[function(t,e){var n;e.exports=n=function(){function t(t){var e,n,r,i;null==t&&(t={}),this.loaded=null!=(e=t.loaded)?e:0,this.total=null!=(n=t.total)?n:0,this.status=null!=(r=t.status)?r:"waiting",this.errors=null!=(i=t.errors)?i:[]}return t.prototype._extend=function(e){var n,r,i,o;return new t({loaded:null!=(n=e.loaded)?n:this.loaded,total:null!=(r=e.total)?r:this.total,status:null!=(i=e.status)?i:this.status,errors:null!=(o=e.errors)?o:this.errors})},t.prototype.isComplete=function(){return this.total&&this.loaded===this.total&&"waiting"===this.status&&!this.errors.length&&!0||!1},t.prototype.withTotal=function(t){return this._extend({total:t})},t.prototype.withLoaded=function(t){return this._extend({loaded:t})},t.prototype.withStatus=function(t){return this._extend({status:t})},t.prototype.withAnError=function(t){var e;return e=this.errors.slice(0),e.push(t),this._extend({errors:e})},t.prototype.withoutAnError=function(t){var e,n;return n=this.errors.slice(0),e=n.indexOf(t),n.splice(e,1),this._extend({errors:n})},t}()},{}],9:[function(t,e){var n,r,i,o;n=t("backbone"),o=t("underscore"),r=t("./FileInfo"),e.exports=i=function(){function t(t){var e,n,r;this.file=null!=(e=t.file)?e:null,this.fileInfo=null!=(n=t.fileInfo)?n:null,this.error=null!=(r=t.error)?r:null,this.uploading=t.uploading||!1,this.deleting=t.deleting||!1,this.id=null!=this.file?this.file.webkitRelativePath||this.file.name:this.fileInfo.name,this.attributes=this}return t.prototype=Object.create(n.Events),t.prototype.defaults={file:null,fileInfo:null,error:null,uploading:!1,deleting:!1},t.prototype.get=function(t){return this[t]},t.prototype.set=function(e){var n,r;this._previousAttributes=new t(this);for(n in e)r=e[n],this[n]=r;return this.trigger("change",this),this._previousAttributes=null},t.prototype.previousAttributes=function(){return this._previousAttributes},t.prototype.size=function(){var t;return null!=this._size?this._size:this._size=null!=(t=this.file)?t.size:void 0},t.prototype.lastModifiedDate=function(){var t;return null!=this._lastModifiedDate?this._lastModifiedDate:this._lastModifiedDate=null!=(t=this.file)?t.lastModifiedDate:void 0},t.prototype.updateWithProgress=function(t){var e;return e=new r(this.id,this.lastModifiedDate(),t.total,t.loaded),this.set({fileInfo:e})},t.prototype.getProgress=function(){return null==this.fileInfo||this.hasConflict()?null!=this.file?{loaded:0,total:this.size()}:void 0:{loaded:this.fileInfo.loaded,total:this.fileInfo.total}},t.prototype.isFullyUploaded=function(){return null!=this.fileInfo&&null==this.error&&!this.uploading&&!this.deleting&&this.fileInfo.loaded===this.fileInfo.total},t.prototype.hasConflict=function(){return null!=this.fileInfo&&null!=this.file&&(this.fileInfo.name!==this.id||this.fileInfo.total!==this.size()||this.fileInfo.lastModifiedDate.getTime()!==this.lastModifiedDate().getTime())},t}()},{"./FileInfo":5,backbone:2,underscore:3}],10:[function(t,e){var n,r,i,o;n=t("backbone"),r=t("./Upload"),o=function(){function t(){this._clear()}return t.prototype._clear=function(){return this.deleting=[],this.uploading=[],this.unfinished=[],this.unstarted=[]},t.prototype.uploadAttributesToState=function(t){var e;return e=null!=t.error?null:t.deleting?"deleting":t.uploading?"uploading":null!=t.file&&null!=t.fileInfo&&t.fileInfo.loaded<t.fileInfo.total?"unfinished":null!=t.file&&null==t.fileInfo?"unstarted":null},t.prototype.addBatch=function(t){var e,n,r,i;for(r=0,i=t.length;i>r;r++)n=t[r],e=this.uploadAttributesToState(n.attributes),null!=e&&this[e].push(n);return void 0},t.prototype._removeUploadFromArray=function(t,e){var n;return n=e.indexOf(t),n>=0?e.splice(n,1):void 0},t.prototype.remove=function(t){var e;return e=this.uploadAttributesToState(t.attributes),null!=e?this._removeUploadFromArray(t.attributes,this[e]):void 0},t.prototype.change=function(t){var e,n;return n=this.uploadAttributesToState(t.previousAttributes()),e=this.uploadAttributesToState(t.attributes),n!==e&&(null!=n&&this._removeUploadFromArray(t,this[n]),null!=e)?this[e].push(t):void 0},t.prototype.reset=function(t){return null==t&&(t=[]),this._clear(),this.addBatch(t)},t.prototype.next=function(){var t,e,n,r;return null!=(t=null!=(e=null!=(n=null!=(r=this.deleting[0])?r:this.uploading[0])?n:this.unfinished[0])?e:this.unstarted[0])?t:null},t}(),e.exports=i=function(){function t(){this.models=[],this._priorityQueue=new o,this.reset([])}return t.prototype=Object.create(n.Events),t.prototype.each=function(t,e){return this.models.forEach(t,e)},t.prototype.map=function(t,e){return this.models.map(t,e)},t.prototype._prepareModel=function(t){return t instanceof r?t:new r(t)},t.prototype.reset=function(t){var e,n,r,i,o,s,u;for(s=this.models,n=0,i=s.length;i>n;n++)e=s[n],e.off("all",this._onUploadEvent,this);for(this.models=function(){var n,r,i,o;for(i=null!=t?t:[],o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(this._prepareModel(e));return o}.call(this),this.length=this.models.length,this._idToModel={},u=this.models,r=0,o=u.length;o>r;r++)e=u[r],e.on("all",this._onUploadEvent,this),this._idToModel[e.id]=e;return this._priorityQueue.reset(this.models),this.trigger("reset",this)},t.prototype.get=function(t){var e;return null!=(e=this._idToModel[t])?e:null},t.prototype.forFile=function(t){return this.get(t.webkitRelativePath||t.name)},t.prototype.forFileInfo=function(t){return this.get(t.name)},t.prototype.addFiles=function(t){var e,n;return n=function(){var n,i,o;for(o=[],n=0,i=t.length;i>n;n++)e=t[n],o.push(new r({file:e}));return o}(),this._addWithMerge(n)},t.prototype.addFileInfos=function(t){var e,n;return n=function(){var n,i,o;for(o=[],n=0,i=t.length;i>n;n++)e=t[n],o.push(new r({fileInfo:e}));return o}(),this._addWithMerge(n)},t.prototype.next=function(){return this._priorityQueue.next()},t.prototype.add=function(t){return this.addBatch(null!=t.length?t:[t])},t.prototype.addBatch=function(t){var e,n,r,i,o;for(n=0,i=t.length;i>n;n++)e=t[n],this._idToModel[e.id]=e,e.on("all",this._onUploadEvent,this),this.models.push(e);for(this.length+=t.length,this._priorityQueue.addBatch(t),r=0,o=t.length;o>r;r++)e=t[r],this.trigger("add",e);return this.trigger("add-batch",t)},t.prototype._onUploadEvent=function(t,e){return"add"!==t&&"remove"!==t&&this.trigger.apply(this,arguments),"change"===t?this._priorityQueue.change(e):void 0},t.prototype._addWithMerge=function(t){var e,n,r,i,o,s,u;for(i=[],s=0,u=t.length;u>s;s++)o=t[s],null!=(e=this.get(o.id))?(n=o.get("file"),r=o.get("fileInfo"),null!=n&&e.set({file:n}),null!=r&&e.set({fileInfo:r})):i.push(o);return void(i.length&&this.add(i))},t}()},{"./Upload":9,backbone:2}],11:[function(t,e){var n,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;n=t("backbone"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.defaults={loaded:0,total:0},e.prototype.initialize=function(){var t;if(t=this.get("uploadCollection"),null==t)throw"Must initialize UploadProgress with `uploadCollection`, an UploadCollection";return this._idToLastKnownProgress={},this._updateAndStartListening()},e.prototype._adjust=function(t,e){return this.set({loaded:this.get("loaded")+t,total:this.get("total")+e})},e.prototype.add=function(t){var e;return e=t.getProgress(),this._adjust(e.loaded,e.total),this._idToLastKnownProgress[t.id]=e},e.prototype.reset=function(t){var e,n,r,i,o,s,u,a;for(e=this._idToLastKnownProgress={},n=0,o=0,a=t.models,s=0,u=a.length;u>s;s++)r=a[s],i=r.getProgress(),e[r.id]=i,n+=i.loaded,o+=i.total;return this.set({loaded:n,total:o})},e.prototype.remove=function(t){var e;return e=t.getProgress(),this._adjust(-e.loaded,-e.total),this._idToLastKnownProgress[t.id]=e},e.prototype.change=function(t){var e,n;return n=this._idToLastKnownProgress[t.id],null!=n?(e=t.getProgress(),this._adjust(e.loaded-n.loaded,e.total-n.total),this._idToLastKnownProgress[t.id]=e):void 0},e.prototype._updateAndStartListening=function(){var t,e,n,r,i;for(t=this.get("uploadCollection"),i=["add","remove","change","reset"],n=0,r=i.length;r>n;n++)e=i[n],this.listenTo(t,e,this[e]);return void this.reset(t)},e.prototype.inBatch=function(t){this.stopListening(this.get("uploadCollection"));try{return t()}finally{this._updateAndStartListening()}},e}(n.Model)},{backbone:2}]},{},[1])(1)});