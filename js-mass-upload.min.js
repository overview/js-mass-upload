!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.MassUpload=t()}}(function(){var t;return function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){var r,i,o,s,u,a,l,c,h,f=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=t("backbone"),h=t("underscore"),l=t("./MassUpload/UploadCollection"),o=t("./MassUpload/FileLister"),s=t("./MassUpload/FileUploader"),i=t("./MassUpload/FileDeleter"),a=t("./MassUpload/State"),c=t("./MassUpload/UploadProgress"),e.exports=u=function(t){function e(t){this._removedUploads=[],e.__super__.constructor.call(this,{},t)}return f(e,t),e.prototype.defaults=function(){return{status:"waiting",listFilesProgress:null,listFilesError:null,uploadProgress:null,uploadErrors:[]}},e.prototype.initialize=function(t,e){var n,r;return this._options=e,this.uploads=null!=(n=null!=e?e.uploads:void 0)?n:new l,this._uploadProgress=new c({uploadCollection:this.uploads}),r=function(t){return function(){return t.set({uploadProgress:t._uploadProgress.pick("loaded","total")})}}(this),this.listenTo(this._uploadProgress,"change",r),r(),this.listenTo(this.uploads,"add-batch",this._onUploadBatchAdded),this.listenTo(this.uploads,"change",function(t){return function(e){return t._onUploadChanged(e)}}(this)),this.listenTo(this.uploads,"reset",function(t){return function(){return t._onUploadsReset()}}(this)),this.prepare()},e.prototype.prepare=function(){var t,e,n,r;return t=this._options,this.lister=null!=(e=null!=t?t.lister:void 0)?e:new o(t.doListFiles),this.lister.callbacks={onStart:function(t){return function(){return t.set({status:"listing-files",listFilesError:null})}}(this),onProgress:function(t){return function(e){return t.set({listFilesProgress:e})}}(this),onSuccess:function(t){return function(e){return t.uploads.addFileInfos(e),t._tick()}}(this),onError:function(t){return function(e){return t.set({listFilesError:e,status:"listing-files-error"})}}(this),onStop:function(t){return function(){}}(this)},this.uploader=null!=(n=null!=t?t.uploader:void 0)?n:new s(t.doUploadFile),this.uploader.callbacks={onStart:function(t){return function(t){return t.set({uploading:!0,error:null})}}(this),onStop:function(t){return function(e){return e.set({uploading:!1}),t._tick()}}(this),onSuccess:function(t){return function(t){return t.updateWithProgress({loaded:t.size(),total:t.size()})}}(this),onError:function(t){return function(t,e){return t.set({error:e})}}(this),onProgress:function(t){return function(t,e){return t.updateWithProgress(e)}}(this)},this.deleter=null!=(r=null!=t?t.deleter:void 0)?r:new i(t.doDeleteFile),this.deleter.callbacks={onStart:function(t){return function(e){return t.set({status:"uploading"})}}(this),onSuccess:function(t){return function(e){return t.uploads.remove(e)}}(this),onError:function(t){return function(t,e){return t.set({error:e})}}(this),onStop:function(t){return function(e){return t._tick()}}(this)}},e.prototype.fetchFileInfosFromServer=function(){return this.lister.run()},e.prototype.retryListFiles=function(){return this.fetchFileInfosFromServer()},e.prototype.retryUpload=function(t){return t.set({error:null})},e.prototype.retryAllUploads=function(){return this.uploads.each(function(t){return t.set({error:null})})},e.prototype.addFiles=function(t){return this._uploadProgress.inBatch(function(e){return function(){return e.uploads.addFiles(t)}}(this))},e.prototype.removeUpload=function(t){return t.set({deleting:!0})},e.prototype.abort=function(){return this.uploads.each(function(t){return function(e){return t.removeUpload(e)}}(this)),this.uploads.reset(),this.prepare()},e.prototype._mergeUploadError=function(t,e,n){var r,i;return i=this.get("uploadErrors").slice(0),r=h.sortedIndex(i,{upload:t},function(t){return t.upload.id}),null==e?i.splice(r,0,{upload:t,error:n}):null==n?i.splice(r,1):i[r].error=n,this.set({uploadErrors:i})},e.prototype._onUploadBatchAdded=function(t){var e,n,r,i;for(n=0,r=t.length;r>n;n++)i=t[n],e=i.get("error"),null!=e&&this._mergeUploadError(i,null,e);return this._forceBestTick()},e.prototype._onUploadChanged=function(t){var e,n,r,i;return r=t.previousAttributes().error,i=t.get("error"),r!==i&&this._mergeUploadError(t,r,i),e=t.previousAttributes().deleting,n=t.get("deleting"),n&&!e&&this._removedUploads.push(t),this._forceBestTick()},e.prototype._onUploadsReset=function(){var t;return t=[],this.uploads.each(function(e){var n;return(n=e.get("error"))?t.push({upload:e,error:n}):void 0}),this.set({uploadErrors:t}),this._tick()},e.prototype._tick=function(){var t,e,n;return n=this.uploads.next(),this._currentUpload=n,null!=n&&(n.get("deleting")?this.deleter.run(n):this.uploader.run(n)),e=this.get("uploadErrors").length?"uploading-error":null!=n?"uploading":(t=this.get("uploadProgress"),t.loaded===t.total?"waiting":"waiting-error"),this.set({status:e})},e.prototype._forceBestTick=function(){var t;return t=this.uploads.next(),t!==this._currentUpload?this._currentUpload?this.uploader.abort():this._tick():void 0},e}(r.Model)},{"./MassUpload/FileDeleter":4,"./MassUpload/FileLister":6,"./MassUpload/FileUploader":7,"./MassUpload/State":8,"./MassUpload/UploadCollection":10,"./MassUpload/UploadProgress":11,backbone:2,underscore:3}],2:[function(e,n,r){!function(n,i){if("function"==typeof t&&t.amd)t(["underscore","jquery","exports"],function(t,e,r){n.Backbone=i(n,r,t,e)});else if("undefined"!=typeof r){var o=e("underscore");i(n,r,o)}else n.Backbone=i(n,{},n._,n.jQuery||n.Zepto||n.ender||n.$)}(this,function(t,e,n,r){{var i=t.Backbone,o=[],s=(o.push,o.slice);o.splice}e.VERSION="1.1.2",e.$=r,e.noConflict=function(){return t.Backbone=i,this},e.emulateHTTP=!1,e.emulateJSON=!1;var u=e.Events={on:function(t,e,n){if(!l(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,r){if(!l(this,"once",t,[e,r])||!e)return this;var i=this,o=n.once(function(){i.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,r)},off:function(t,e,r){var i,o,s,u,a,c,h,f;if(!this._events||!l(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._events=void 0,this;for(u=t?[t]:n.keys(this._events),a=0,c=u.length;c>a;a++)if(t=u[a],s=this._events[t]){if(this._events[t]=i=[],e||r)for(h=0,f=s.length;f>h;h++)o=s[h],(e&&e!==o.callback&&e!==o.callback._callback||r&&r!==o.context)&&i.push(o);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&c(n,e),r&&c(r,arguments),this},stopListening:function(t,e,r){var i=this._listeningTo;if(!i)return this;var o=!e&&!r;r||"object"!=typeof e||(r=this),t&&((i={})[t._listenId]=t);for(var s in i)t=i[s],t.off(e,r,this),(o||n.isEmpty(t._events))&&delete this._listeningTo[s];return this}},a=/\s+/,l=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(a.test(n)){for(var o=n.split(a),s=0,u=o.length;u>s;s++)t[e].apply(t,[o[s]].concat(r));return!1}return!0},c=function(t,e){var n,r=-1,i=t.length,o=e[0],s=e[1],u=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,s);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,s,u);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e);return}},h={listenTo:"on",listenToOnce:"once"};n.each(h,function(t,e){u[e]=function(e,r,i){var o=this._listeningTo||(this._listeningTo={}),s=e._listenId||(e._listenId=n.uniqueId("l"));return o[s]=e,i||"object"!=typeof r||(i=this),e[t](r,i,this),this}}),u.bind=u.on,u.unbind=u.off,n.extend(e,u);var f=e.Model=function(t,e){var r=t||{};e||(e={}),this.cid=n.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(r=this.parse(r,e)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(f.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,r){var i,o,s,u,a,l,c,h;if(null==t)return this;if("object"==typeof t?(o=t,r=e):(o={})[t]=e,r||(r={}),!this._validate(o,r))return!1;s=r.unset,a=r.silent,u=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=n.clone(this.attributes),this.changed={}),h=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(i in o)e=o[i],n.isEqual(h[i],e)||u.push(i),n.isEqual(c[i],e)?delete this.changed[i]:this.changed[i]=e,s?delete h[i]:h[i]=e;if(!a){u.length&&(this._pending=r);for(var f=0,p=u.length;p>f;f++)this.trigger("change:"+u[f],this,h[u[f]],r)}if(l)return this;if(!a)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?n.clone(this.changed):!1;var e,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var o in t)n.isEqual(i[o],e=t[o])||((r||(r={}))[o]=e);return r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,r=t.success;return t.success=function(n){return e.set(e.parse(n,t),t)?(r&&r(e,n,t),void e.trigger("sync",e,n,t)):!1},R(this,t),this.sync("read",this,t)},save:function(t,e,r){var i,o,s,u=this.attributes;if(null==t||"object"==typeof t?(i=t,r=e):(i={})[t]=e,r=n.extend({validate:!0},r),i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),void 0===r.parse&&(r.parse=!0);var a=this,l=r.success;return r.success=function(t){a.attributes=u;var e=a.parse(t,r);return r.wait&&(e=n.extend(i||{},e)),n.isObject(e)&&!a.set(e,r)?!1:(l&&l(a,t,r),void a.trigger("sync",a,t,r))},R(this,r),o=this.isNew()?"create":r.patch?"patch":"update","patch"===o&&(r.attrs=i),s=this.sync(o,this,r),i&&r.wait&&(this.attributes=u),s},destroy:function(t){t=t?n.clone(t):{};var e=this,r=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(n){(t.wait||e.isNew())&&i(),r&&r(e,n,t),e.isNew()||e.trigger("sync",e,n,t)},this.isNew())return t.success(),!1;R(this,t);var o=this.sync("delete",this,t);return t.wait||i(),o},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||N();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var r=this.validationError=this.validate(t,e)||null;return r?(this.trigger("invalid",this,r,n.extend(e,{validationError:r})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];n.each(p,function(t){f.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.attributes),n[t].apply(n,e)}});var d=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1};n.extend(d.prototype,u,{model:f,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,v))},remove:function(t,e){var r=!n.isArray(t);t=r?[t]:n.clone(t),e||(e={});var i,o,s,u;for(i=0,o=t.length;o>i;i++)u=t[i]=this.get(t[i]),u&&(delete this._byId[u.id],delete this._byId[u.cid],s=this.indexOf(u),this.models.splice(s,1),this.length--,e.silent||(e.index=s,u.trigger("remove",u,this,e)),this._removeReference(u,e));return r?t[0]:t},set:function(t,e){e=n.defaults({},e,g),e.parse&&(t=this.parse(t,e));var r=!n.isArray(t);t=r?t?[t]:[]:n.clone(t);var i,o,s,u,a,l,c,h=e.at,p=this.model,d=this.comparator&&null==h&&e.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,y=[],m=[],_={},b=e.add,w=e.merge,x=e.remove,k=!d&&b&&x?[]:!1;for(i=0,o=t.length;o>i;i++){if(a=t[i]||{},s=a instanceof f?u=a:a[p.prototype.idAttribute||"id"],l=this.get(s))x&&(_[l.cid]=!0),w&&(a=a===u?u.attributes:a,e.parse&&(a=l.parse(a,e)),l.set(a,e),d&&!c&&l.hasChanged(v)&&(c=!0)),t[i]=l;else if(b){if(u=t[i]=this._prepareModel(a,e),!u)continue;y.push(u),this._addReference(u,e)}u=l||u,!k||!u.isNew()&&_[u.id]||k.push(u),_[u.id]=!0}if(x){for(i=0,o=this.length;o>i;++i)_[(u=this.models[i]).cid]||m.push(u);m.length&&this.remove(m,e)}if(y.length||k&&k.length)if(d&&(c=!0),this.length+=y.length,null!=h)for(i=0,o=y.length;o>i;i++)this.models.splice(h+i,0,y[i]);else{k&&(this.models.length=0);var S=k||y;for(i=0,o=S.length;o>i;i++)this.models.push(S[i])}if(c&&this.sort({silent:!0}),!e.silent){for(i=0,o=y.length;o>i;i++)(u=y[i]).trigger("add",u,this,e);(c||k&&k.length)&&this.trigger("sort",this,e)}return r?t[0]:t},reset:function(t,e){e||(e={});for(var r=0,i=this.models.length;i>r;r++)this._removeReference(this.models[r],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return n.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return n.invoke(this.models,"get",t)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,r=this;return t.success=function(n){var i=t.reset?"reset":"set";r[i](n,t),e&&e(r,n,t),r.trigger("sync",r,n,t)},R(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?n.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var r=this,i=e.success;return e.success=function(t,n){e.wait&&r.add(t,e),i&&i(t,n,e)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof f)return t;e=e?n.clone(e):{},e.collection=this;var r=new this.model(t,e);return r.validationError?(this.trigger("invalid",this,r.validationError,e),!1):r},_addReference:function(t,e){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(y,function(t){d.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),n[t].apply(n,e)}});var m=["groupBy","countBy","sortBy","indexBy"];n.each(m,function(t){d.prototype[t]=function(e,r){var i=n.isFunction(e)?e:function(t){return t.get(e)};return n[t](this.models,i,r)}});var _=e.View=function(t){this.cid=n.uniqueId("view"),t||(t={}),n.extend(this,n.pick(t,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];n.extend(_.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=n.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var r=t[e];if(n.isFunction(r)||(r=this[t[e]]),r){var i=e.match(b),o=i[1],s=i[2];r=n.bind(r,this),o+=".delegateEvents"+this.cid,""===s?this.$el.on(o,r):this.$el.on(o,s,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t["class"]=n.result(this,"className"));var r=e.$("<"+n.result(this,"tagName")+">").attr(t);this.setElement(r,!1)}}}),e.sync=function(t,r,i){var o=k[t];n.defaults(i||(i={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:o,dataType:"json"};if(i.url||(s.url=n.result(r,"url")||N()),null!=i.data||!r||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),i.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",i.emulateJSON&&(s.data._method=o);var u=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",o),u?u.apply(this,arguments):void 0}}"GET"===s.type||i.emulateJSON||(s.processData=!1),"PATCH"===s.type&&x&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=e.ajax(n.extend(s,i));return r.trigger("request",r,a,i),a};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var S=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,U=/\*\w+/g,T=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(S.prototype,u,{initialize:function(){},route:function(t,r,i){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var o=this;return e.history.route(t,function(n){var s=o._extractParameters(t,n);o.execute(i,s),o.trigger.apply(o,["route:"+r].concat(s)),o.trigger("route",r,s),e.history.trigger("route",o,r,s)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(T,"\\$&").replace(E,"(?:$1)?").replace(A,function(t,e){return e?t:"([^/?]+)"}).replace(U,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return n.map(r,function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null})}});var I=e.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,M=/^\/+|\/+$/g,P=/msie [\w.]+/,j=/\/$/,O=/#.*$/;I.started=!1,n.extend(I.prototype,u,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(j,"");t.indexOf(n)||(t=t.slice(n.length))}else t=this.getHash();return t.replace(F,"")},start:function(t){if(I.started)throw new Error("Backbone.history has already been started");I.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,o=P.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);if(this.root=("/"+this.root+"/").replace(M,"/"),o&&this._wantsHashChange){var s=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),I.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),n.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!I.started)return!1;e&&e!==!0||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=t.replace(O,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),e.history=new I;var C=function(t,e){var r,i=this;r=t&&n.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},n.extend(r,i,e);var o=function(){this.constructor=r};return o.prototype=i.prototype,r.prototype=new o,t&&n.extend(r.prototype,t),r.__super__=i.prototype,r};f.extend=d.extend=S.extend=_.extend=I.extend=C;var N=function(){throw new Error('A "url" property or function must be specified')},R=function(t,e){var n=e.error;e.error=function(r){n&&n(t,r,e),t.trigger("error",t,r,e)}};return e})},{underscore:3}],3:[function(e,n,r){(function(){function e(t){function e(e,n,r,i,o,s){for(;o>=0&&s>o;o+=t){var u=i?i[o]:o;r=n(r,e[u],u,e)}return r}return function(n,r,i,o){r=x(r,o,4);var s=!I(n)&&w.keys(n),u=(s||n).length,a=t>0?0:u-1;return arguments.length<3&&(i=n[s?s[a]:a],a+=t),e(n,r,i,s,a,u)}}function i(t){return function(e,n,r){n=k(n,r);for(var i=T(e),o=t>0?0:i-1;o>=0&&i>o;o+=t)if(n(e[o],o,e))return o;return-1}}function o(t,e,n){return function(r,i,o){var s=0,u=T(r);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+u,s):u=o>=0?Math.min(o+1,u):o+u+1;else if(n&&o&&u)return o=n(r,i),r[o]===i?o:-1;if(i!==i)return o=e(p.call(r,s,u),w.isNaN),o>=0?o+s:-1;for(o=t>0?s:u-1;o>=0&&u>o;o+=t)if(r[o]===i)return o;return-1}}function s(t,e){var n=O.length,r=t.constructor,i=w.isFunction(r)&&r.prototype||c,o="constructor";for(w.has(t,o)&&!w.contains(e,o)&&e.push(o);n--;)o=O[n],o in t&&t[o]!==i[o]&&!w.contains(e,o)&&e.push(o)}var u=this,a=u._,l=Array.prototype,c=Object.prototype,h=Function.prototype,f=l.push,p=l.slice,d=c.toString,g=c.hasOwnProperty,v=Array.isArray,y=Object.keys,m=h.bind,_=Object.create,b=function(){},w=function(t){return t instanceof w?t:this instanceof w?void(this._wrapped=t):new w(t)};"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=w),r._=w):u._=w,w.VERSION="1.8.3";var x=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}},k=function(t,e,n){return null==t?w.identity:w.isFunction(t)?x(t,e,n):w.isObject(t)?w.matcher(t):w.property(t)};w.iteratee=function(t,e){return k(t,e,1/0)};var S=function(t,e){return function(n){var r=arguments.length;if(2>r||null==n)return n;for(var i=1;r>i;i++)for(var o=arguments[i],s=t(o),u=s.length,a=0;u>a;a++){var l=s[a];e&&void 0!==n[l]||(n[l]=o[l])}return n}},E=function(t){if(!w.isObject(t))return{};if(_)return _(t);b.prototype=t;var e=new b;return b.prototype=null,e},A=function(t){return function(e){return null==e?void 0:e[t]}},U=Math.pow(2,53)-1,T=A("length"),I=function(t){var e=T(t);return"number"==typeof e&&e>=0&&U>=e};w.each=w.forEach=function(t,e,n){e=x(e,n);var r,i;if(I(t))for(r=0,i=t.length;i>r;r++)e(t[r],r,t);else{var o=w.keys(t);for(r=0,i=o.length;i>r;r++)e(t[o[r]],o[r],t)}return t},w.map=w.collect=function(t,e,n){e=k(e,n);for(var r=!I(t)&&w.keys(t),i=(r||t).length,o=Array(i),s=0;i>s;s++){var u=r?r[s]:s;o[s]=e(t[u],u,t)}return o},w.reduce=w.foldl=w.inject=e(1),w.reduceRight=w.foldr=e(-1),w.find=w.detect=function(t,e,n){var r;return r=I(t)?w.findIndex(t,e,n):w.findKey(t,e,n),void 0!==r&&-1!==r?t[r]:void 0},w.filter=w.select=function(t,e,n){var r=[];return e=k(e,n),w.each(t,function(t,n,i){e(t,n,i)&&r.push(t)}),r},w.reject=function(t,e,n){return w.filter(t,w.negate(k(e)),n)},w.every=w.all=function(t,e,n){e=k(e,n);for(var r=!I(t)&&w.keys(t),i=(r||t).length,o=0;i>o;o++){var s=r?r[o]:o;if(!e(t[s],s,t))return!1}return!0},w.some=w.any=function(t,e,n){e=k(e,n);for(var r=!I(t)&&w.keys(t),i=(r||t).length,o=0;i>o;o++){var s=r?r[o]:o;if(e(t[s],s,t))return!0}return!1},w.contains=w.includes=w.include=function(t,e,n,r){return I(t)||(t=w.values(t)),("number"!=typeof n||r)&&(n=0),w.indexOf(t,e,n)>=0},w.invoke=function(t,e){var n=p.call(arguments,2),r=w.isFunction(e);return w.map(t,function(t){var i=r?e:t[e];return null==i?i:i.apply(t,n)})},w.pluck=function(t,e){return w.map(t,w.property(e))},w.where=function(t,e){return w.filter(t,w.matcher(e))},w.findWhere=function(t,e){return w.find(t,w.matcher(e))},w.max=function(t,e,n){var r,i,o=-(1/0),s=-(1/0);if(null==e&&null!=t){t=I(t)?t:w.values(t);for(var u=0,a=t.length;a>u;u++)r=t[u],r>o&&(o=r)}else e=k(e,n),w.each(t,function(t,n,r){i=e(t,n,r),(i>s||i===-(1/0)&&o===-(1/0))&&(o=t,s=i)});return o},w.min=function(t,e,n){var r,i,o=1/0,s=1/0;if(null==e&&null!=t){t=I(t)?t:w.values(t);for(var u=0,a=t.length;a>u;u++)r=t[u],o>r&&(o=r)}else e=k(e,n),w.each(t,function(t,n,r){i=e(t,n,r),(s>i||i===1/0&&o===1/0)&&(o=t,s=i)});return o},w.shuffle=function(t){for(var e,n=I(t)?t:w.values(t),r=n.length,i=Array(r),o=0;r>o;o++)e=w.random(0,o),e!==o&&(i[o]=i[e]),i[e]=n[o];return i},w.sample=function(t,e,n){return null==e||n?(I(t)||(t=w.values(t)),t[w.random(t.length-1)]):w.shuffle(t).slice(0,Math.max(0,e))},w.sortBy=function(t,e,n){return e=k(e,n),w.pluck(w.map(t,function(t,n,r){return{value:t,index:n,criteria:e(t,n,r)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return t.index-e.index}),"value")};var F=function(t){return function(e,n,r){var i={};return n=k(n,r),w.each(e,function(r,o){var s=n(r,o,e);t(i,r,s)}),i}};w.groupBy=F(function(t,e,n){w.has(t,n)?t[n].push(e):t[n]=[e]}),w.indexBy=F(function(t,e,n){t[n]=e}),w.countBy=F(function(t,e,n){w.has(t,n)?t[n]++:t[n]=1}),w.toArray=function(t){return t?w.isArray(t)?p.call(t):I(t)?w.map(t,w.identity):w.values(t):[]},w.size=function(t){return null==t?0:I(t)?t.length:w.keys(t).length},w.partition=function(t,e,n){e=k(e,n);var r=[],i=[];return w.each(t,function(t,n,o){(e(t,n,o)?r:i).push(t)}),[r,i]},w.first=w.head=w.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:w.initial(t,t.length-e)},w.initial=function(t,e,n){return p.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},w.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:w.rest(t,Math.max(0,t.length-e))},w.rest=w.tail=w.drop=function(t,e,n){return p.call(t,null==e||n?1:e)},w.compact=function(t){return w.filter(t,w.identity)};var M=function(t,e,n,r){for(var i=[],o=0,s=r||0,u=T(t);u>s;s++){var a=t[s];if(I(a)&&(w.isArray(a)||w.isArguments(a))){e||(a=M(a,e,n));var l=0,c=a.length;for(i.length+=c;c>l;)i[o++]=a[l++]}else n||(i[o++]=a)}return i};w.flatten=function(t,e){return M(t,e,!1)},w.without=function(t){return w.difference(t,p.call(arguments,1))},w.uniq=w.unique=function(t,e,n,r){w.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=k(n,r));for(var i=[],o=[],s=0,u=T(t);u>s;s++){var a=t[s],l=n?n(a,s,t):a;e?(s&&o===l||i.push(a),o=l):n?w.contains(o,l)||(o.push(l),i.push(a)):w.contains(i,a)||i.push(a)}return i},w.union=function(){return w.uniq(M(arguments,!0,!0))},w.intersection=function(t){for(var e=[],n=arguments.length,r=0,i=T(t);i>r;r++){var o=t[r];if(!w.contains(e,o)){for(var s=1;n>s&&w.contains(arguments[s],o);s++);s===n&&e.push(o)}}return e},w.difference=function(t){var e=M(arguments,!0,!0,1);return w.filter(t,function(t){return!w.contains(e,t)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(t){for(var e=t&&w.max(t,T).length||0,n=Array(e),r=0;e>r;r++)n[r]=w.pluck(t,r);return n},w.object=function(t,e){for(var n={},r=0,i=T(t);i>r;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},w.findIndex=i(1),w.findLastIndex=i(-1),
w.sortedIndex=function(t,e,n,r){n=k(n,r,1);for(var i=n(e),o=0,s=T(t);s>o;){var u=Math.floor((o+s)/2);n(t[u])<i?o=u+1:s=u}return o},w.indexOf=o(1,w.findIndex,w.sortedIndex),w.lastIndexOf=o(-1,w.findLastIndex),w.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;r>o;o++,t+=n)i[o]=t;return i};var P=function(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var o=E(t.prototype),s=t.apply(o,i);return w.isObject(s)?s:o};w.bind=function(t,e){if(m&&t.bind===m)return m.apply(t,p.call(arguments,1));if(!w.isFunction(t))throw new TypeError("Bind must be called on a function");var n=p.call(arguments,2),r=function(){return P(t,r,e,this,n.concat(p.call(arguments)))};return r},w.partial=function(t){var e=p.call(arguments,1),n=function(){for(var r=0,i=e.length,o=Array(i),s=0;i>s;s++)o[s]=e[s]===w?arguments[r++]:e[s];for(;r<arguments.length;)o.push(arguments[r++]);return P(t,n,this,this,o)};return n},w.bindAll=function(t){var e,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(e=1;r>e;e++)n=arguments[e],t[n]=w.bind(t[n],t);return t},w.memoize=function(t,e){var n=function(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return w.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},w.delay=function(t,e){var n=p.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},w.defer=w.partial(w.delay,w,1),w.throttle=function(t,e,n){var r,i,o,s=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:w.now(),s=null,o=t.apply(r,i),s||(r=i=null)};return function(){var l=w.now();u||n.leading!==!1||(u=l);var c=e-(l-u);return r=this,i=arguments,0>=c||c>e?(s&&(clearTimeout(s),s=null),u=l,o=t.apply(r,i),s||(r=i=null)):s||n.trailing===!1||(s=setTimeout(a,c)),o}},w.debounce=function(t,e,n){var r,i,o,s,u,a=function(){var l=w.now()-s;e>l&&l>=0?r=setTimeout(a,e-l):(r=null,n||(u=t.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,s=w.now();var l=n&&!r;return r||(r=setTimeout(a,e)),l&&(u=t.apply(o,i),o=i=null),u}},w.wrap=function(t,e){return w.partial(e,t)},w.negate=function(t){return function(){return!t.apply(this,arguments)}},w.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},w.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},w.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),1>=t&&(e=null),n}},w.once=w.partial(w.before,2);var j=!{toString:null}.propertyIsEnumerable("toString"),O=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(t){if(!w.isObject(t))return[];if(y)return y(t);var e=[];for(var n in t)w.has(t,n)&&e.push(n);return j&&s(t,e),e},w.allKeys=function(t){if(!w.isObject(t))return[];var e=[];for(var n in t)e.push(n);return j&&s(t,e),e},w.values=function(t){for(var e=w.keys(t),n=e.length,r=Array(n),i=0;n>i;i++)r[i]=t[e[i]];return r},w.mapObject=function(t,e,n){e=k(e,n);for(var r,i=w.keys(t),o=i.length,s={},u=0;o>u;u++)r=i[u],s[r]=e(t[r],r,t);return s},w.pairs=function(t){for(var e=w.keys(t),n=e.length,r=Array(n),i=0;n>i;i++)r[i]=[e[i],t[e[i]]];return r},w.invert=function(t){for(var e={},n=w.keys(t),r=0,i=n.length;i>r;r++)e[t[n[r]]]=n[r];return e},w.functions=w.methods=function(t){var e=[];for(var n in t)w.isFunction(t[n])&&e.push(n);return e.sort()},w.extend=S(w.allKeys),w.extendOwn=w.assign=S(w.keys),w.findKey=function(t,e,n){e=k(e,n);for(var r,i=w.keys(t),o=0,s=i.length;s>o;o++)if(r=i[o],e(t[r],r,t))return r},w.pick=function(t,e,n){var r,i,o={},s=t;if(null==s)return o;w.isFunction(e)?(i=w.allKeys(s),r=x(e,n)):(i=M(arguments,!1,!1,1),r=function(t,e,n){return e in n},s=Object(s));for(var u=0,a=i.length;a>u;u++){var l=i[u],c=s[l];r(c,l,s)&&(o[l]=c)}return o},w.omit=function(t,e,n){if(w.isFunction(e))e=w.negate(e);else{var r=w.map(M(arguments,!1,!1,1),String);e=function(t,e){return!w.contains(r,e)}}return w.pick(t,e,n)},w.defaults=S(w.allKeys,!0),w.create=function(t,e){var n=E(t);return e&&w.extendOwn(n,e),n},w.clone=function(t){return w.isObject(t)?w.isArray(t)?t.slice():w.extend({},t):t},w.tap=function(t,e){return e(t),t},w.isMatch=function(t,e){var n=w.keys(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;r>o;o++){var s=n[o];if(e[s]!==i[s]||!(s in i))return!1}return!0};var C=function(t,e,n,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof w&&(t=t._wrapped),e instanceof w&&(e=e._wrapped);var i=d.call(t);if(i!==d.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,u=e.constructor;if(s!==u&&!(w.isFunction(s)&&s instanceof s&&w.isFunction(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],r=r||[];for(var a=n.length;a--;)if(n[a]===t)return r[a]===e;if(n.push(t),r.push(e),o){if(a=t.length,a!==e.length)return!1;for(;a--;)if(!C(t[a],e[a],n,r))return!1}else{var l,c=w.keys(t);if(a=c.length,w.keys(e).length!==a)return!1;for(;a--;)if(l=c[a],!w.has(e,l)||!C(t[l],e[l],n,r))return!1}return n.pop(),r.pop(),!0};w.isEqual=function(t,e){return C(t,e)},w.isEmpty=function(t){return null==t?!0:I(t)&&(w.isArray(t)||w.isString(t)||w.isArguments(t))?0===t.length:0===w.keys(t).length},w.isElement=function(t){return!(!t||1!==t.nodeType)},w.isArray=v||function(t){return"[object Array]"===d.call(t)},w.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){w["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),w.isArguments(arguments)||(w.isArguments=function(t){return w.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(w.isFunction=function(t){return"function"==typeof t||!1}),w.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},w.isNaN=function(t){return w.isNumber(t)&&t!==+t},w.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===d.call(t)},w.isNull=function(t){return null===t},w.isUndefined=function(t){return void 0===t},w.has=function(t,e){return null!=t&&g.call(t,e)},w.noConflict=function(){return u._=a,this},w.identity=function(t){return t},w.constant=function(t){return function(){return t}},w.noop=function(){},w.property=A,w.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},w.matcher=w.matches=function(t){return t=w.extendOwn({},t),function(e){return w.isMatch(e,t)}},w.times=function(t,e,n){var r=Array(Math.max(0,t));e=x(e,n,1);for(var i=0;t>i;i++)r[i]=e(i);return r},w.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},w.now=Date.now||function(){return(new Date).getTime()};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},R=w.invert(N),$=function(t){var e=function(e){return t[e]},n="(?:"+w.keys(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}};w.escape=$(N),w.unescape=$(R),w.result=function(t,e,n){var r=null==t?void 0:t[e];return void 0===r&&(r=n),w.isFunction(r)?r.call(t):r};var B=0;w.uniqueId=function(t){var e=++B+"";return t?t+e:e},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\u2028|\u2029/g,D=function(t){return"\\"+H[t]};w.template=function(t,e,n){!e&&n&&(e=n),e=w.defaults({},e,w.templateSettings);var r=RegExp([(e.escape||L).source,(e.interpolate||L).source,(e.evaluate||L).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,function(e,n,r,s,u){return o+=t.slice(i,u).replace(z,D),i=u+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(u){throw u.source=o,u}var a=function(t){return s.call(this,t,w)},l=e.variable||"obj";return a.source="function("+l+"){\n"+o+"}",a},w.chain=function(t){var e=w(t);return e._chain=!0,e};var q=function(t,e){return t._chain?w(e).chain():e};w.mixin=function(t){w.each(w.functions(t),function(e){var n=w[e]=t[e];w.prototype[e]=function(){var t=[this._wrapped];return f.apply(t,arguments),q(this,n.apply(w,t))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=l[t];w.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],q(this,n)}}),w.each(["concat","join","slice"],function(t){var e=l[t];w.prototype[t]=function(){return q(this,e.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof t&&t.amd&&t("underscore",[],function(){return w})}).call(this)},{}],4:[function(t,e,n){var r;e.exports=r=function(){function t(t,e){this.doDeleteFile=t,this.callbacks=null!=e?e:{},this.running=!1}return t.prototype.run=function(t){var e;if(this.running)throw"already running";return this.running=!0,"function"==typeof(e=this.callbacks).onStart&&e.onStart(t),this.doDeleteFile(t,function(e){return function(n){return n?e._onError(t,n):e._onSuccess(t)}}(this))},t.prototype._onSuccess=function(t){var e;return"function"==typeof(e=this.callbacks).onSuccess&&e.onSuccess(t),this._onStop(t)},t.prototype._onError=function(t,e){var n;return"function"==typeof(n=this.callbacks).onError&&n.onError(t,e),this._onStop(t)},t.prototype._onStop=function(t){var e;return this.running=!1,void("function"==typeof(e=this.callbacks).onStop&&e.onStop(t))},t}()},{}],5:[function(t,e,n){var r;e.exports=r=function(){function t(t,e,n,r){this.name=t,this.lastModifiedDate=e,this.total=n,this.loaded=r}return t}(),r.fromJson=function(t){return new r(t.name,new Date(t.lastModifiedDate),t.total,t.loaded)},r.fromFile=function(t){return new r(t.webkitRelativePath||t.name,t.lastModifiedDate,t.size,0)}},{}],6:[function(t,e,n){var r;e.exports=r=function(){function t(t,e){this.doListFiles=t,this.callbacks=e,this.running=!1}return t.prototype.run=function(){var t;if(this.running)throw"already running";return this.running=!0,"function"==typeof(t=this.callbacks).onStart&&t.onStart(),this.doListFiles(function(t){return function(e){var n;return"function"==typeof(n=t.callbacks).onProgress?n.onProgress(e):void 0}}(this),function(t){return function(e,n){return null!=e?t._onError(e):t._onSuccess(n)}}(this))},t.prototype._onSuccess=function(t){var e;return"function"==typeof(e=this.callbacks).onSuccess&&e.onSuccess(t),this._onStop()},t.prototype._onError=function(t){return this.callbacks.onError(t),this._onStop()},t.prototype._onStop=function(){var t;return this.running=!1,"function"==typeof(t=this.callbacks).onStop?t.onStop():void 0},t}()},{}],7:[function(t,e,n){var r,i;r=t("./FileInfo"),e.exports=i=function(){function t(t,e){this.doUpload=t,this.callbacks=e,this._upload=null,this._abortCallback=null,this._aborting=!1}return t.prototype.run=function(t){var e;if(null!=this._upload)throw"already running";return this._upload=t,"function"==typeof(e=this.callbacks).onStart&&e.onStart(t),this._abortCallback=this.doUpload(t,function(e){return function(n){return e._onProgress(t,n)}}(this),function(e){return function(n){return n?e._onError(t,n):e._onSuccess(t)}}(this))},t.prototype.abort=function(){return this._upload&&!this._aborting&&(this._aborting=!0,"function"==typeof this._abortCallback)?this._abortCallback():void 0},t.prototype._onProgress=function(t,e){var n;return"function"==typeof(n=this.callbacks).onProgress?n.onProgress(t,e):void 0},t.prototype._onSuccess=function(t){var e;return"function"==typeof(e=this.callbacks).onSuccess&&e.onSuccess(t),this._onStop(t)},t.prototype._onError=function(t,e){var n;return"function"==typeof(n=this.callbacks).onError&&n.onError(t,e),this._onStop(t)},t.prototype._onStop=function(t){var e;return this._upload=null,this._abortCallback=null,this._aborting=!1,"function"==typeof(e=this.callbacks).onStop?e.onStop(t):void 0},t}()},{"./FileInfo":5}],8:[function(t,e,n){var r;e.exports=r=function(){function t(t){var e,n,r,i;null==t&&(t={}),this.loaded=null!=(e=t.loaded)?e:0,this.total=null!=(n=t.total)?n:0,this.status=null!=(r=t.status)?r:"waiting",this.errors=null!=(i=t.errors)?i:[]}return t.prototype._extend=function(e){var n,r,i,o;return new t({loaded:null!=(n=e.loaded)?n:this.loaded,total:null!=(r=e.total)?r:this.total,status:null!=(i=e.status)?i:this.status,errors:null!=(o=e.errors)?o:this.errors})},t.prototype.isComplete=function(){return this.total&&this.loaded===this.total&&"waiting"===this.status&&!this.errors.length&&!0||!1},t.prototype.withTotal=function(t){return this._extend({total:t})},t.prototype.withLoaded=function(t){return this._extend({loaded:t})},t.prototype.withStatus=function(t){return this._extend({status:t})},t.prototype.withAnError=function(t){var e;return e=this.errors.slice(0),e.push(t),this._extend({errors:e})},t.prototype.withoutAnError=function(t){var e,n;return n=this.errors.slice(0),e=n.indexOf(t),n.splice(e,1),this._extend({errors:n})},t}()},{}],9:[function(t,e,n){var r,i,o,s;r=t("backbone"),s=t("underscore"),i=t("./FileInfo"),e.exports=o=function(){function t(t){var e,n,r;this.file=null!=(e=t.file)?e:null,this.fileInfo=null!=(n=t.fileInfo)?n:null,this.error=null!=(r=t.error)?r:null,this.uploading=t.uploading||!1,this.deleting=t.deleting||!1,this.id=null!=this.file?this.file.webkitRelativePath||this.file.name:this.fileInfo.name,this.attributes=this}return t.prototype=Object.create(r.Events),t.prototype.defaults={file:null,fileInfo:null,error:null,uploading:!1,deleting:!1},t.prototype.get=function(t){return this[t]},t.prototype.set=function(e){var n,r;this._previousAttributes=new t(this);for(n in e)r=e[n],this[n]=r;return this.trigger("change",this),this._previousAttributes=null},t.prototype.previousAttributes=function(){return this._previousAttributes},t.prototype.size=function(){var t;return null!=this._size?this._size:this._size=null!=(t=this.file)?t.size:void 0},t.prototype.lastModifiedDate=function(){var t;return null!=this._lastModifiedDate?this._lastModifiedDate:this._lastModifiedDate=null!=(t=this.file)?t.lastModifiedDate:void 0},t.prototype.updateWithProgress=function(t){var e;return e=new i(this.id,this.lastModifiedDate(),t.total,t.loaded),this.set({fileInfo:e})},t.prototype.getProgress=function(){return null==this.fileInfo||this.hasConflict()?null!=this.file?{loaded:0,total:this.size()}:void 0:{loaded:this.fileInfo.loaded,total:this.fileInfo.total}},t.prototype.isFullyUploaded=function(){return null!=this.fileInfo&&null==this.error&&!this.uploading&&!this.deleting&&this.fileInfo.loaded===this.fileInfo.total},t.prototype.hasConflict=function(){var t,e;return null!=this.fileInfo&&null!=this.file&&(this.fileInfo.name!==this.id||this.fileInfo.total!==this.size()||(null!=(t=this.fileInfo.lastModifiedDate)&&"function"==typeof t.getTime?t.getTime():void 0)!==(null!=(e=this.lastModifiedDate())&&"function"==typeof e.getTime?e.getTime():void 0))},t}()},{"./FileInfo":5,backbone:2,underscore:3}],10:[function(t,e,n){var r,i,o,s;r=t("backbone"),i=t("./Upload"),s=function(){function t(){this._clear()}return t.prototype._clear=function(){return this.deleting=[],this.uploading=[],this.unfinished=[],this.unstarted=[]},t.prototype.uploadAttributesToState=function(t){var e;return e=null!=t.error?null:t.deleting?"deleting":t.uploading?"uploading":null!=t.file&&null!=t.fileInfo&&t.fileInfo.loaded<t.fileInfo.total?"unfinished":null!=t.file&&null==t.fileInfo?"unstarted":null},t.prototype.addBatch=function(t){var e,n,r,i;for(e=0,n=t.length;n>e;e++)i=t[e],r=this.uploadAttributesToState(i.attributes),null!=r&&this[r].push(i);return void 0},t.prototype._removeUploadFromArray=function(t,e){var n;return n=e.indexOf(t),n>=0?e.splice(n,1):void 0},t.prototype.remove=function(t){var e;return e=this.uploadAttributesToState(t.attributes),null!=e?this._removeUploadFromArray(t.attributes,this[e]):void 0},t.prototype.change=function(t){var e,n;return n=this.uploadAttributesToState(t.previousAttributes()),e=this.uploadAttributesToState(t.attributes),n!==e&&(null!=n&&this._removeUploadFromArray(t,this[n]),null!=e)?this[e].push(t):void 0},t.prototype.reset=function(t){return null==t&&(t=[]),this._clear(),this.addBatch(t)},t.prototype.next=function(){var t,e,n,r;return null!=(t=null!=(e=null!=(n=null!=(r=this.deleting[0])?r:this.uploading[0])?n:this.unfinished[0])?e:this.unstarted[0])?t:null},t}(),e.exports=o=function(){function t(){this.models=[],this._priorityQueue=new s,this.reset([])}return t.prototype=Object.create(r.Events),t.prototype.each=function(t,e){return this.models.forEach(t,e)},t.prototype.map=function(t,e){return this.models.map(t,e)},t.prototype.remove=function(t){var e;if(e=this.models.indexOf(t),-1===e)throw"Upload not found";return t.off("all",this._onUploadEvent,this),delete this._idToModel[t.id],this._priorityQueue.remove(t),this.trigger("remove",t,this),this.models.splice(e,1),this.length=this.models.length},t.prototype._prepareModel=function(t){return t instanceof i?t:new i(t)},t.prototype.reset=function(t){var e,n,r,i,o,s,u;for(o=this.models,e=0,r=o.length;r>e;e++)u=o[e],u.off("all",this._onUploadEvent,this);for(this.models=function(){var e,n,r,i;for(r=null!=t?t:[],i=[],e=0,n=r.length;n>e;e++)u=r[e],i.push(this._prepareModel(u));return i}.call(this),this.length=this.models.length,this._idToModel={},s=this.models,n=0,i=s.length;i>n;n++)u=s[n],u.on("all",this._onUploadEvent,this),this._idToModel[u.id]=u;return this._priorityQueue.reset(this.models),this.trigger("reset",this)},t.prototype.get=function(t){var e;return null!=(e=this._idToModel[t])?e:null},t.prototype.forFile=function(t){return this.get(t.webkitRelativePath||t.name)},t.prototype.forFileInfo=function(t){return this.get(t.name)},t.prototype.addFiles=function(t){var e,n;return n=function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(new i({file:e}));return o}(),this._addWithMerge(n)},t.prototype.addFileInfos=function(t){var e,n;return n=function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(new i({fileInfo:e}));return o}(),this._addWithMerge(n)},t.prototype.next=function(){return this._priorityQueue.next()},t.prototype.add=function(t){return this.addBatch(null!=t.length?t:[t])},t.prototype.addBatch=function(t){var e,n,r,i,o;for(e=0,r=t.length;r>e;e++)o=t[e],this._idToModel[o.id]=o,o.on("all",this._onUploadEvent,this),this.models.push(o);for(this.length+=t.length,this._priorityQueue.addBatch(t),n=0,i=t.length;i>n;n++)o=t[n],this.trigger("add",o);return this.trigger("add-batch",t)},t.prototype._onUploadEvent=function(t,e,n,r){return"add"!==t&&"remove"!==t&&this.trigger.apply(this,arguments),"change"===t?this._priorityQueue.change(e):void 0},t.prototype._addWithMerge=function(t){var e,n,r,i,o,s,u;for(s=[],i=0,o=t.length;o>i;i++)u=t[i],null!=(e=this.get(u.id))?(n=u.get("file"),r=u.get("fileInfo"),null!=n&&e.set({file:n}),null!=r&&e.set({fileInfo:r})):s.push(u);return void(s.length&&this.add(s))},t}()},{"./Upload":9,backbone:2}],11:[function(t,e,n){var r,i,o=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("backbone"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.defaults={loaded:0,total:0},e.prototype.initialize=function(){var t;if(t=this.get("uploadCollection"),null==t)throw"Must initialize UploadProgress with `uploadCollection`, an UploadCollection";return this._idToLastKnownProgress={},this._updateAndStartListening()},e.prototype._adjust=function(t,e){return this.set({loaded:this.get("loaded")+t,total:this.get("total")+e})},e.prototype.add=function(t){var e;return e=t.getProgress(),this._adjust(e.loaded,e.total),this._idToLastKnownProgress[t.id]=e},e.prototype.reset=function(t){var e,n,r,i,o,s,u,a;for(n=this._idToLastKnownProgress={},i=0,a=0,u=t.models,e=0,r=u.length;r>e;e++)o=u[e],s=o.getProgress(),n[o.id]=s,i+=s.loaded,a+=s.total;return this.set({loaded:i,total:a})},e.prototype.remove=function(t){var e;return e=t.getProgress(),this._adjust(-e.loaded,-e.total),this._idToLastKnownProgress[t.id]=e},e.prototype.change=function(t){var e,n;return n=this._idToLastKnownProgress[t.id],null!=n?(e=t.getProgress(),this._adjust(e.loaded-n.loaded,e.total-n.total),this._idToLastKnownProgress[t.id]=e):void 0},e.prototype._updateAndStartListening=function(){var t,e,n,r,i;for(t=this.get("uploadCollection"),i=["add","remove","change","reset"],n=0,r=i.length;r>n;n++)e=i[n],this.listenTo(t,e,this[e]);return void this.reset(t)},e.prototype.inBatch=function(t){this.stopListening(this.get("uploadCollection"));try{return t()}finally{this._updateAndStartListening()}},e}(r.Model)},{backbone:2}]},{},[1])(1)});