/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(){var t,o,e;!function(r){function n(t,o){return S.call(t,o)}function i(t,o){var e,r,n,i,s,l,u,a,p,d,c,h=o&&o.split("/"),f=y.map,g=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(o){for(h=h.slice(0,h.length-1),t=t.split("/"),s=t.length-1,y.nodeIdCompat&&m.test(t[s])&&(t[s]=t[s].replace(m,"")),t=h.concat(t),p=0;p<t.length;p+=1)if(c=t[p],"."===c)t.splice(p,1),p-=1;else if(".."===c){if(1===p&&(".."===t[2]||".."===t[0]))break;p>0&&(t.splice(p-1,2),p-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||g)&&f){for(e=t.split("/"),p=e.length;p>0;p-=1){if(r=e.slice(0,p).join("/"),h)for(d=h.length;d>0;d-=1)if(n=f[h.slice(0,d).join("/")],n&&(n=n[r])){i=n,l=p;break}if(i)break;!u&&g&&g[r]&&(u=g[r],a=p)}!i&&u&&(i=u,l=a),i&&(e.splice(0,l,i),t=e.join("/"))}return t}function s(t,o){return function(){return h.apply(r,U.call(arguments,0).concat([t,o]))}}function l(t){return function(o){return i(o,t)}}function u(t){return function(o){_[t]=o}}function a(t){if(n(v,t)){var o=v[t];delete v[t],b[t]=!0,c.apply(r,o)}if(!n(_,t)&&!n(b,t))throw new Error("No "+t);return _[t]}function p(t){var o,e=t?t.indexOf("!"):-1;return e>-1&&(o=t.substring(0,e),t=t.substring(e+1,t.length)),[o,t]}function d(t){return function(){return y&&y.config&&y.config[t]||{}}}var c,h,f,g,_={},v={},y={},b={},S=Object.prototype.hasOwnProperty,U=[].slice,m=/\.js$/;f=function(t,o){var e,r=p(t),n=r[0];return t=r[1],n&&(n=i(n,o),e=a(n)),n?t=e&&e.normalize?e.normalize(t,l(o)):i(t,o):(t=i(t,o),r=p(t),n=r[0],t=r[1],n&&(e=a(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:e}},g={require:function(t){return s(t)},exports:function(t){var o=_[t];return"undefined"!=typeof o?o:_[t]={}},module:function(t){return{id:t,uri:"",exports:_[t],config:d(t)}}},c=function(t,o,e,i){var l,p,d,c,h,y,S=[],U=typeof e;if(i=i||t,"undefined"===U||"function"===U){for(o=!o.length&&e.length?["require","exports","module"]:o,h=0;h<o.length;h+=1)if(c=f(o[h],i),p=c.f,"require"===p)S[h]=g.require(t);else if("exports"===p)S[h]=g.exports(t),y=!0;else if("module"===p)l=S[h]=g.module(t);else if(n(_,p)||n(v,p)||n(b,p))S[h]=a(p);else{if(!c.p)throw new Error(t+" missing "+p);c.p.load(c.n,s(i,!0),u(p),{}),S[h]=_[p]}d=e?e.apply(_[t],S):void 0,t&&(l&&l.exports!==r&&l.exports!==_[t]?_[t]=l.exports:d===r&&y||(_[t]=d))}else t&&(_[t]=e)},t=o=h=function(t,o,e,n,i){if("string"==typeof t)return g[t]?g[t](o):a(f(t,o).f);if(!t.splice){if(y=t,y.deps&&h(y.deps,y.callback),!o)return;o.splice?(t=o,o=e,e=null):t=r}return o=o||function(){},"function"==typeof e&&(e=n,n=i),n?c(r,t,o,e):setTimeout(function(){c(r,t,o,e)},4),h},h.config=function(t){return h(t)},t._defined=_,e=function(t,o,e){o.splice||(e=o,o=[]),n(_,t)||n(v,t)||(v[t]=[t,o,e])},e.amd={jQuery:!0}}(),e("almond",function(){}),e("MassUpload/FileInfo",[],function(){var t;return t=function(){function t(t,o,e,r){this.name=t,this.lastModifiedDate=o,this.total=e,this.loaded=r}return t}(),t.fromJson=function(o){return new t(o.name,new Date(o.lastModifiedDate),o.total,o.loaded)},t.fromFile=function(o){return new t(o.name,o.lastModifiedDate,o.size,0)},t}),e("MassUpload/Upload",["backbone","./FileInfo"],function(t,o){var e;return e=function(){function e(t){var o,e,r,n;this.file=null!=(o=t.file)?o:null,this.fileInfo=null!=(e=t.fileInfo)?e:null,this.error=null!=(r=t.error)?r:null,this.uploading=t.uploading||!1,this.deleting=t.deleting||!1,this.id=(null!=(n=this.fileInfo)?n:this.file).name,this.attributes=this}return e.prototype=Object.create(t.Events),e.prototype.defaults={file:null,fileInfo:null,error:null,uploading:!1,deleting:!1},e.prototype.get=function(t){return this[t]},e.prototype.set=function(t){var o,r;this._previousAttributes=new e(this);for(o in t)r=t[o],this[o]=r;return this.trigger("change",this),this._previousAttributes=null},e.prototype.previousAttributes=function(){return this._previousAttributes},e.prototype.size=function(){var t;return null!=this._size?this._size:this._size=null!=(t=this.file)?t.size:void 0},e.prototype.lastModifiedDate=function(){var t;return null!=this._lastModifiedDate?this._lastModifiedDate:this._lastModifiedDate=null!=(t=this.file)?t.lastModifiedDate:void 0},e.prototype.updateWithProgress=function(t){var e;return e=new o(this.id,this.lastModifiedDate(),t.total,t.loaded),this.set({fileInfo:e})},e.prototype.getProgress=function(){return null==this.fileInfo||this.hasConflict()?null!=this.file?{loaded:0,total:this.size()}:void 0:{loaded:this.fileInfo.loaded,total:this.fileInfo.total}},e.prototype.isFullyUploaded=function(){return null!=this.fileInfo&&null==this.error&&!this.uploading&&!this.deleting&&this.fileInfo.loaded===this.fileInfo.total},e.prototype.hasConflict=function(){return null!=this.fileInfo&&null!=this.file&&(this.fileInfo.name!==this.id||this.fileInfo.total!==this.size()||this.fileInfo.lastModifiedDate.getTime()!==this.lastModifiedDate().getTime())},e}()}),e("MassUpload/UploadCollection",["backbone","./Upload"],function(t,o){var e,r;return r=function(){function t(){this._clear()}return t.prototype._clear=function(){return this.deleting=[],this.uploading=[],this.unfinished=[],this.unstarted=[]},t.prototype.uploadAttributesToState=function(t){var o;return o=null!=t.error?null:t.deleting?"deleting":t.uploading?"uploading":null!=t.file&&null!=t.fileInfo&&t.fileInfo.loaded<t.fileInfo.total?"unfinished":null!=t.file&&null==t.fileInfo?"unstarted":null},t.prototype.addBatch=function(t){var o,e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],o=this.uploadAttributesToState(e.attributes),null!=o&&this[o].push(e);return void 0},t.prototype._removeUploadFromArray=function(t,o){var e;return e=o.indexOf(t),e>=0?o.splice(e,1):void 0},t.prototype.remove=function(t){var o;return o=this.uploadAttributesToState(t.attributes),null!=o?this._removeUploadFromArray(t.attributes,this[o]):void 0},t.prototype.change=function(t){var o,e;return e=this.uploadAttributesToState(t.previousAttributes()),o=this.uploadAttributesToState(t.attributes),e!==o&&(null!=e&&this._removeUploadFromArray(t,this[e]),null!=o)?this[o].push(t):void 0},t.prototype.reset=function(t){return null==t&&(t=[]),this._clear(),this.addBatch(t)},t.prototype.next=function(){var t,o,e,r;return null!=(t=null!=(o=null!=(e=null!=(r=this.deleting[0])?r:this.uploading[0])?e:this.unfinished[0])?o:this.unstarted[0])?t:null},t}(),e=function(){function e(){this.models=[],this._priorityQueue=new r,this.reset([])}return e.prototype=Object.create(t.Events),e.prototype.each=function(t,o){return this.models.forEach(t,o)},e.prototype.map=function(t,o){return this.models.map(t,o)},e.prototype._prepareModel=function(t){return t instanceof o?t:new o(t)},e.prototype.reset=function(t){var o,e,r,n,i,s,l;for(s=this.models,e=0,n=s.length;n>e;e++)o=s[e],o.off("all",this._onUploadEvent,this);for(this.models=function(){var e,r,n,i;for(n=null!=t?t:[],i=[],e=0,r=n.length;r>e;e++)o=n[e],i.push(this._prepareModel(o));return i}.call(this),this.length=this.models.length,this._idToModel={},l=this.models,r=0,i=l.length;i>r;r++)o=l[r],o.on("all",this._onUploadEvent,this),this._idToModel[o.id]=o;return this._priorityQueue.reset(this.models),this.trigger("reset",this)},e.prototype.get=function(t){var o;return null!=(o=this._idToModel[t])?o:null},e.prototype.addFiles=function(t){var e,r;return r=function(){var r,n,i;for(i=[],r=0,n=t.length;n>r;r++)e=t[r],i.push(new o({file:e}));return i}(),this._addWithMerge(r)},e.prototype.addFileInfos=function(t){var e,r;return r=function(){var r,n,i;for(i=[],r=0,n=t.length;n>r;r++)e=t[r],i.push(new o({fileInfo:e}));return i}(),this._addWithMerge(r)},e.prototype.next=function(){return this._priorityQueue.next()},e.prototype.add=function(t){return null!=t.length?this.addBatch(t):this.addBatch([t])},e.prototype.addBatch=function(t){var o,e,r,n,i;for(e=0,n=t.length;n>e;e++)o=t[e],this._idToModel[o.id]=o,o.on("all",this._onUploadEvent,this),this.models.push(o);for(this.length+=t.length,this._priorityQueue.addBatch(t),r=0,i=t.length;i>r;r++)o=t[r],this.trigger("add",o);return this.trigger("add-batch",t)},e.prototype._onUploadEvent=function(t,o){return"add"!==t&&"remove"!==t&&this.trigger.apply(this,arguments),"change"===t?this._priorityQueue.change(o):void 0},e.prototype._addWithMerge=function(t){var o,e,r,n,i,s,l;for(n=[],s=0,l=t.length;l>s;s++)i=t[s],null!=(o=this.get(i.id))?(e=i.get("file"),r=i.get("fileInfo"),null!=e&&o.set({file:e}),null!=r&&o.set({fileInfo:r})):n.push(i);return n.length&&this.add(n),void 0},e}()}),e("MassUpload/FileLister",[],function(){var t;return t=function(){function t(t,o){this.doListFiles=t,this.callbacks=o,this.running=!1}return t.prototype.run=function(){var t,o=this;if(this.running)throw"already running";return this.running=!0,"function"==typeof(t=this.callbacks).onStart&&t.onStart(),this.doListFiles(function(t){var e;return"function"==typeof(e=o.callbacks).onProgress?e.onProgress(t):void 0},function(t){return o._onSuccess(t)},function(t){return o._onError(t)})},t.prototype._onSuccess=function(t){var o;return"function"==typeof(o=this.callbacks).onSuccess&&o.onSuccess(t),this._onStop()},t.prototype._onError=function(t){return this.callbacks.onError(t),this._onStop()},t.prototype._onStop=function(){var t;return this.running=!1,"function"==typeof(t=this.callbacks).onStop?t.onStop():void 0},t}()}),e("MassUpload/FileUploader",["./FileInfo"],function(){var t;return t=function(){function t(t,o){this.doUpload=t,this.callbacks=o,this._file=null,this._abortCallback=null,this._aborting=!1}return t.prototype.run=function(t){var o,e=this;if(null!=this._file)throw"already running";return this._file=t,"function"==typeof(o=this.callbacks).onStart&&o.onStart(this._file),this._abortCallback=this.doUpload(t,function(o){return e._onProgress(t,o)},function(){return e._onSuccess(t)},function(o){return e._onError(t,o)})},t.prototype.abort=function(){return this._file&&!this._aborting&&(this._aborting=!0,"function"==typeof this._abortCallback)?this._abortCallback():void 0},t.prototype._onProgress=function(t,o){var e;return"function"==typeof(e=this.callbacks).onProgress?e.onProgress(t,o):void 0},t.prototype._onSuccess=function(t){var o;return"function"==typeof(o=this.callbacks).onSuccess&&o.onSuccess(t),this._onStop(t)},t.prototype._onError=function(t,o){var e;return"function"==typeof(e=this.callbacks).onError&&e.onError(t,o),this._onStop(t)},t.prototype._onStop=function(t){var o;return this._file=null,this._abortCallback=null,this._aborting=!1,"function"==typeof(o=this.callbacks).onStop?o.onStop(t):void 0},t}()}),e("MassUpload/FileDeleter",[],function(){var t;return t=function(){function t(t,o){this.doDeleteFile=t,this.callbacks=null!=o?o:{},this.running=!1}return t.prototype.run=function(t){var o,e=this;if(this.running)throw"already running";return this.running=!0,"function"==typeof(o=this.callbacks).onStart&&o.onStart(t),this.doDeleteFile(t,function(){return e._onSuccess(t)},function(o){return e._onError(t,o)})},t.prototype._onSuccess=function(t){var o;return"function"==typeof(o=this.callbacks).onSuccess&&o.onSuccess(t),this._onStop(t)},t.prototype._onError=function(t,o){var e;return"function"==typeof(e=this.callbacks).onError&&e.onError(t,o),this._onStop(t)},t.prototype._onStop=function(t){var o;return this.running=!1,"function"==typeof(o=this.callbacks).onStop&&o.onStop(t),void 0},t}()}),e("MassUpload/State",[],function(){var t;return t=function(){function t(t){var o,e,r,n;null==t&&(t={}),this.loaded=null!=(o=t.loaded)?o:0,this.total=null!=(e=t.total)?e:0,this.status=null!=(r=t.status)?r:"waiting",this.errors=null!=(n=t.errors)?n:[]}return t.prototype._extend=function(o){var e,r,n,i;return new t({loaded:null!=(e=o.loaded)?e:this.loaded,total:null!=(r=o.total)?r:this.total,status:null!=(n=o.status)?n:this.status,errors:null!=(i=o.errors)?i:this.errors})},t.prototype.isComplete=function(){return this.total&&this.loaded===this.total&&"waiting"===this.status&&!this.errors.length&&!0||!1},t.prototype.withTotal=function(t){return this._extend({total:t})},t.prototype.withLoaded=function(t){return this._extend({loaded:t})},t.prototype.withStatus=function(t){return this._extend({status:t})},t.prototype.withAnError=function(t){var o;return o=this.errors.slice(0),o.push(t),this._extend({errors:o})},t.prototype.withoutAnError=function(t){var o,e;return e=this.errors.slice(0),o=e.indexOf(t),e.splice(o,1),this._extend({errors:e})},t}()}),e("MassUpload/UploadProgress",["backbone"],function(t){return t.Model.extend({defaults:{loaded:0,total:0},initialize:function(){var t;if(t=this.get("uploadCollection"),null==t)throw"Must initialize UploadProgress with `uploadCollection`, an UploadCollection";return this._idToLastKnownProgress={},this._updateAndStartListening()},_adjust:function(t,o){return this.set({loaded:this.get("loaded")+t,total:this.get("total")+o})},add:function(t){var o;return o=t.getProgress(),this._adjust(o.loaded,o.total),this._idToLastKnownProgress[t.id]=o},reset:function(t){var o,e,r,n,i,s,l,u;for(o=this._idToLastKnownProgress={},e=0,i=0,u=t.models,s=0,l=u.length;l>s;s++)r=u[s],n=r.getProgress(),o[r.id]=n,e+=n.loaded,i+=n.total;return this.set({loaded:e,total:i})},remove:function(t){var o;return o=t.getProgress(),this._adjust(-o.loaded,-o.total),this._idToLastKnownProgress[t.id]=o},change:function(t){var o,e;return e=this._idToLastKnownProgress[t.id],null!=e?(o=t.getProgress(),this._adjust(o.loaded-e.loaded,o.total-e.total),this._idToLastKnownProgress[t.id]=o):void 0},_updateAndStartListening:function(){var t,o,e,r,n;for(t=this.get("uploadCollection"),n=["add","remove","change","reset"],e=0,r=n.length;r>e;e++)o=n[e],this.listenTo(t,o,this[o]);return this.reset(t),void 0},inBatch:function(t){this.stopListening(this.get("uploadCollection"));try{return t()}finally{this._updateAndStartListening()}}})});var r={}.hasOwnProperty,n=function(t,o){function e(){this.constructor=t}for(var n in o)r.call(o,n)&&(t[n]=o[n]);return e.prototype=o.prototype,t.prototype=new e,t.__super__=o.prototype,t};e("MassUpload",["backbone","underscore","MassUpload/UploadCollection","MassUpload/FileLister","MassUpload/FileUploader","MassUpload/FileDeleter","MassUpload/State","MassUpload/UploadProgress"],function(t,o,e,r,i,s,l,u){var a;return a=function(t){function l(t){this._removedUploads=[],l.__super__.constructor.call(this,{},t)}return n(l,t),l.prototype.defaults=function(){return{status:"waiting",listFilesProgress:null,listFilesError:null,uploadProgress:null,uploadErrors:[]}},l.prototype.initialize=function(t,o){var r,n,i=this;return this._options=o,this.uploads=null!=(n=null!=o?o.uploads:void 0)?n:new e,this._uploadProgress=new u({uploadCollection:this.uploads}),r=function(){return i.set({uploadProgress:i._uploadProgress.pick("loaded","total")})},this.listenTo(this._uploadProgress,"change",r),r(),this.listenTo(this.uploads,"add-batch",this._onUploadBatchAdded),this.listenTo(this.uploads,"change",function(t){return i._onUploadChanged(t)}),this.listenTo(this.uploads,"reset",function(){return i._onUploadsReset()}),this.prepare()},l.prototype.prepare=function(){var t,o,e,n,l=this;return t=this._options,this.lister=null!=(o=null!=t?t.lister:void 0)?o:new r(t.doListFiles),this.lister.callbacks={onStart:function(){return l._onListerStart()},onProgress:function(t){return l._onListerProgress(t)},onSuccess:function(t){return l._onListerSuccess(t)},onError:function(t){return l._onListerError(t)},onStop:function(){return l._onListerStop()}},this.uploader=null!=(e=null!=t?t.uploader:void 0)?e:new i(t.doUploadFile),this.uploader.callbacks={onStart:function(t){return l._onUploaderStart(t)},onStop:function(t){return l._onUploaderStop(t)},onSuccess:function(t){return l._onUploaderSuccess(t)},onError:function(t,o){return l._onUploaderError(t,o)},onProgress:function(t,o){return l._onUploaderProgress(t,o)}},this.deleter=null!=(n=null!=t?t.deleter:void 0)?n:new s(t.doDeleteFile),this.deleter.callbacks={onStart:function(t){return l._onDeleterStart(t)},onSuccess:function(t){return l._onDeleterSuccess(t)},onError:function(t,o){return l._onDeleterError(t,o)},onStop:function(t){return l._onDeleterStop(t)}}},l.prototype.fetchFileInfosFromServer=function(){return this.lister.run()},l.prototype.retryListFiles=function(){return this.fetchFileInfosFromServer()},l.prototype.retryUpload=function(t){return t.set({error:null})},l.prototype.retryAllUploads=function(){return this.uploads.each(function(t){return t.set({error:null})})},l.prototype.addFiles=function(t){var o=this;return this._uploadProgress.inBatch(function(){return o.uploads.addFiles(t)})},l.prototype.removeUpload=function(t){return t.set({deleting:!0})},l.prototype.abort=function(){var t=this;return this.uploads.each(function(o){return t.removeUpload(o)}),this.uploads.reset(),this.prepare()},l.prototype._onListerStart=function(){return this.set({status:"listing-files",listFilesError:null})},l.prototype._onListerProgress=function(t){return this.set({listFilesProgress:t})},l.prototype._onListerSuccess=function(t){return this.uploads.addFileInfos(t),this._tick()},l.prototype._onListerError=function(t){return this.set({listFilesError:t,status:"listing-files-error"})},l.prototype._onListerStop=function(){},l.prototype._mergeUploadError=function(t,e,r){var n,i;return i=this.get("uploadErrors").slice(0),n=o.sortedIndex(i,{upload:t},function(t){return t.upload.id}),null==e?i.splice(n,0,{upload:t,error:r}):null==r?i.splice(n,1):i[n].error=r,this.set({uploadErrors:i})},l.prototype._onUploadBatchAdded=function(t){var o,e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],o=e.get("error"),null!=o&&this._mergeUploadError(e,null,o);return this._forceBestTick()},l.prototype._onUploadChanged=function(t){var o,e,r,n;return r=t.previousAttributes().error,n=t.get("error"),r!==n&&this._mergeUploadError(t,r,n),o=t.previousAttributes().deleting,e=t.get("deleting"),e&&!o&&this._removedUploads.push(t),this._forceBestTick()},l.prototype._onUploadsReset=function(){var t;return t=[],this.uploads.each(function(o){var e;return(e=o.get("error"))?t.push({upload:o,error:e}):void 0}),this.set({uploadErrors:t}),this._tick()},l.prototype._onUploaderStart=function(t){var o;return o=this.uploads.get(t.name),o.set({uploading:!0,error:null})},l.prototype._onUploaderStop=function(t){var o;return o=this.uploads.get(t.name),o.set({uploading:!1}),this._tick()},l.prototype._onUploaderProgress=function(t,o){var e;return e=this.uploads.get(t.name),e.updateWithProgress(o)},l.prototype._onUploaderError=function(t,o){var e;return e=this.uploads.get(t.name),e.set({error:o})},l.prototype._onUploaderSuccess=function(t){var o;return o=this.uploads.get(t.name),o.updateWithProgress({loaded:o.size(),total:o.size()})},l.prototype._onDeleterStart=function(){return this.set({status:"uploading"})},l.prototype._onDeleterSuccess=function(t){var o;return o=this.uploads.get(t.name),this.uploads.remove(o)},l.prototype._onDeleterError=function(t,o){var e;return e=this.uploads.get(t.name),e.set({error:o})},l.prototype._onDeleterStop=function(){return this._tick()},l.prototype._tick=function(){var t,o,e;return e=this.uploads.next(),this._currentUpload=e,null!=e&&(e.get("deleting")?this.deleter.run(e.get("fileInfo")):this.uploader.run(e.get("file"))),o=this.get("uploadErrors").length?"uploading-error":null!=e?"uploading":(t=this.get("uploadProgress"),t.loaded===t.total?"waiting":"waiting-error"),this.set({status:o})},l.prototype._forceBestTick=function(){var t;return t=this.uploads.next(),t!==this._currentUpload?this._currentUpload?this.uploader.abort():this._tick():void 0},l}(t.Model)}),o(["./MassUpload"],function(t){return window.MassUpload=t}),e("index",function(){})}();